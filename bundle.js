/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t,e,i,s,r,o,a={811:(t,e,i)=>{i.d(e,{g:()=>o});var s=i(607),r=i(464);class o{constructor(t,...e){this.history=new s.d(t),this.checks=e,this.steps=[],this.lastPlaneState=null}addCheck(t){this.checks.push(t)}addStep(t){this.steps.push(t)}detect(t){t.planeState.size>0&&(t.planeState.forEach(((e,i)=>{const s=t.missileState.get(i),o=r.Z.length(r.Z.subtract(e.xy,s.xy)),a=r.Z.angle(e.v,s.v),n=Math.sign(r.Z.dotProduct(e.v,s.v))>=0,l=r.Z.behind(s.v,s.xy,e.xy),h=s.lastMissileIsDead;this.history.push({t:e.t,dist:o,angle:a,sameDir:n,behind:l,missileIsDead:h})})),this.checks.forEach((t=>t(this.history))))}step(t){if(t.planeState.size>0){const e=t.getLatestPlaneState(),i=t.getLatestMissileState();if(this.lastPlaneState===e)return;this.lastPlaneState=e;const s=r.Z.length(r.Z.subtract(e.xy,i.xy)),o=r.Z.angle(e.v,i.v),a=Math.sign(r.Z.dotProduct(e.v,i.v))>=0,n=r.Z.behind(i.v,i.xy,e.xy),l=i.lastMissileIsDead;let h={t:e.t,dist:s,angle:o,sameDir:a,behind:n,missileIsDead:l};this.steps.forEach((t=>t(h)))}}}},349:(t,e,i)=>{i.d(e,{PE:()=>V,ZJ:()=>U,OQ:()=>R,jA:()=>Z,Vk:()=>F,Cp:()=>I,JA:()=>D,Hs:()=>E,JO:()=>S,qF:()=>P,gF:()=>k,$7:()=>C,Vz:()=>z,Ux:()=>B,MB:()=>O});var s=i(925);function r(t,e,i,s,r){const o=t.map(((t,i)=>r().init(t,e[i])));return t=>o.map((e=>e.progress((t-i)/(s-i))))}function o(t,e,i,o,a,n,l){let h=r(t,e,0,o,a),c=s.Z.now(),d=t,u=null,f=()=>{if(null!==u){try{l&&l(d)}catch(t){console.error(t)}s.Z.clear(u),u=null}},g=()=>{let t=s.Z.now()-c;d=h(t);try{n&&n(d)}catch(t){console.error(t)}t>o&&f()};return u=s.Z.periodic(g,i),g(),Object.assign((()=>d),{cancel:f})}class a{init(t,e){return this.from=t,this.to=e,this._init(),this}_init(){throw new Error("Not implemented")}progress(t){throw new Error("Not implemented")}}a.ease=()=>()=>new l,a.linear=t=>()=>new n(t);class n extends a{constructor(t){super(),this.shift=t}_init(){this.t1s=0,this.t2s=1,this.shift<0&&(this.t1s=0+1*-this.shift),this.shift>0&&(this.t2s=0+1*(1-this.shift)),this.step=(this.to-this.from)/(this.t2s-this.t1s)}progress(t){return t<=this.t1s?this.from:t>=this.t2s?this.to:this.from+this.step*(t-this.t1s)}}class l extends a{_init(){}progress(t){return this.from+Math.sin(Math.PI/2*t)*(this.to-this.from)}}var h=i(751),c=i(464);const d="input is invalid type",u="0123456789abcdef".split(""),f=[-2147483648,8388608,32768,128],g=[24,16,8,0],p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];class m{constructor(t=!1){this.block=0,this.start=0,this.bytes=0,this.hBytes=0,this.finalized=!1,this.hashed=!1,this.first=!0,this.init(t)}init(t){this.is224=t,this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225)}update(t){if(!this.finalized){var e,i=typeof t;if("string"!==i){if("object"!==i)throw new Error(d);if(null===t)throw new Error(d);if(t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error(d);e=!0}for(var s,r,o=0,a=t.length,n=this.blocks;o<a;){if(this.hashed&&(this.hashed=!1,n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),e)for(r=this.start;o<a&&r<64;++o)n[r>>2]|=t[o]<<g[3&r++];else for(r=this.start;o<a&&r<64;++o)(s=t.charCodeAt(o))<128?n[r>>2]|=s<<g[3&r++]:s<2048?(n[r>>2]|=(192|s>>6)<<g[3&r++],n[r>>2]|=(128|63&s)<<g[3&r++]):s<55296||s>=57344?(n[r>>2]|=(224|s>>12)<<g[3&r++],n[r>>2]|=(128|s>>6&63)<<g[3&r++],n[r>>2]|=(128|63&s)<<g[3&r++]):(s=65536+((1023&s)<<10|1023&t.charCodeAt(++o)),n[r>>2]|=(240|s>>18)<<g[3&r++],n[r>>2]|=(128|s>>12&63)<<g[3&r++],n[r>>2]|=(128|s>>6&63)<<g[3&r++],n[r>>2]|=(128|63&s)<<g[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=n[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}}finalize(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=f[3&e],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}}hash(){var t,e,i,s,r,o,a,n,l,h=this.h0,c=this.h1,d=this.h2,u=this.h3,f=this.h4,g=this.h5,m=this.h6,y=this.h7,x=this.blocks;for(t=16;t<64;++t)e=((r=x[t-15])>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,i=((r=x[t-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,x[t]=x[t-16]+e+x[t-7]+i<<0;for(l=c&d,t=0;t<64;t+=4)this.first?(this.is224?(o=300032,y=(r=x[0]-1413257819)-150054599<<0,u=r+24177077<<0):(o=704751109,y=(r=x[0]-210244248)-1521486534<<0,u=r+143694565<<0),this.first=!1):(e=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),s=(o=h&c)^h&d^l,y=u+(r=y+(i=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&g^~f&m)+p[t]+x[t])<<0,u=r+(e+s)<<0),e=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),s=(a=u&h)^u&c^o,m=d+(r=m+(i=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7))+(y&f^~y&g)+p[t+1]+x[t+1])<<0,e=((d=r+(e+s)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),s=(n=d&u)^d&h^a,g=c+(r=g+(i=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&y^~m&f)+p[t+2]+x[t+2])<<0,e=((c=r+(e+s)<<0)>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),s=(l=c&d)^c&u^n,f=h+(r=f+(i=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&m^~g&y)+p[t+3]+x[t+3])<<0,h=r+(e+s)<<0;this.h0=this.h0+h<<0,this.h1=this.h1+c<<0,this.h2=this.h2+d<<0,this.h3=this.h3+u<<0,this.h4=this.h4+f<<0,this.h5=this.h5+g<<0,this.h6=this.h6+m<<0,this.h7=this.h7+y<<0}hex(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,s=this.h3,r=this.h4,o=this.h5,a=this.h6,n=this.h7,l=u[t>>28&15]+u[t>>24&15]+u[t>>20&15]+u[t>>16&15]+u[t>>12&15]+u[t>>8&15]+u[t>>4&15]+u[15&t]+u[e>>28&15]+u[e>>24&15]+u[e>>20&15]+u[e>>16&15]+u[e>>12&15]+u[e>>8&15]+u[e>>4&15]+u[15&e]+u[i>>28&15]+u[i>>24&15]+u[i>>20&15]+u[i>>16&15]+u[i>>12&15]+u[i>>8&15]+u[i>>4&15]+u[15&i]+u[s>>28&15]+u[s>>24&15]+u[s>>20&15]+u[s>>16&15]+u[s>>12&15]+u[s>>8&15]+u[s>>4&15]+u[15&s]+u[r>>28&15]+u[r>>24&15]+u[r>>20&15]+u[r>>16&15]+u[r>>12&15]+u[r>>8&15]+u[r>>4&15]+u[15&r]+u[o>>28&15]+u[o>>24&15]+u[o>>20&15]+u[o>>16&15]+u[o>>12&15]+u[o>>8&15]+u[o>>4&15]+u[15&o]+u[a>>28&15]+u[a>>24&15]+u[a>>20&15]+u[a>>16&15]+u[a>>12&15]+u[a>>8&15]+u[a>>4&15]+u[15&a];return this.is224||(l+=u[n>>28&15]+u[n>>24&15]+u[n>>20&15]+u[n>>16&15]+u[n>>12&15]+u[n>>8&15]+u[n>>4&15]+u[15&n]),l}toString(){return this.hex()}digest(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,s=this.h3,r=this.h4,o=this.h5,a=this.h6,n=this.h7,l=[t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24&255,i>>16&255,i>>8&255,255&i,s>>24&255,s>>16&255,s>>8&255,255&s,r>>24&255,r>>16&255,r>>8&255,255&r,o>>24&255,o>>16&255,o>>8&255,255&o,a>>24&255,a>>16&255,a>>8&255,255&a];return this.is224||l.push(n>>24&255,n>>16&255,n>>8&255,255&n),l}array(){return this.digest()}arrayBuffer(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),t}}var y=i(485),x=i(165),v=i(350);class b{constructor(){this.target=null}}class w{constructor(t){this.game=null,this.xy=c.Z.clone(t),this.dead=!1,this.layer=0,this.id=w.idPrefix+"-"+w.idIndex++,this.infoItems=new Map,this._subscribers=[]}setGame(t){this.game=t}getGame(){return this.game}isStatic(){return!1}emit(t){t.target=this,this._subscribers.forEach((e=>e(t)))}subscribe(t){this._subscribers.push(t)}__serialize(){return{xy:this.xy,dead:this.dead,id:this.id,layer:this.layer}}__unserialize(t){this.xy=t.xy,this.dead=t.dead,this.id=t.id,this.layer=t.layer,y.Z.getLink("game",(t=>this.game=t))}getRegion(){return h.yp.EMPTY}getCollideRegion(){return this.getRegion()}progress(t){}draw(t){if(this.drawInfo(t),this.selected){const e=this.getRegion().getBoundingBox();t.strokeStyle="#999900",t.rect(e[0],e[1],Math.abs(e[2]-e[0]),Math.abs(e[3]-e[1])),t.stroke()}}addInfo(t,e,i,r){if("function"!=typeof e){let t=e.toString();e=()=>t}this.removeInfo(t);let o=void 0!==i&&i>0?s.Z.set((()=>this.removeInfo(t)),i):null;this.infoItems.set(t,{textSupplier:e,timerId:o,color:r})}removeInfo(t){let e=this.infoItems.get(t);void 0!==e&&(null!==e.timerId&&s.Z.clear(e.timerId),this.infoItems.delete(t))}drawInfo(t){if(0==this.infoItems.size)return;t.save();const e=x.T.infoFontSize,i=e+x.T.infoFontSize/2;let s=this.xy[0]+20,r=this.xy[1];t.font=`${e}px serif`,t.textBaseline="top",t.globalAlpha=x.T.infoAlpha;for(let e of this.infoItems.values()){let o=e.textSupplier();t.fillStyle=e.color||x.T.infoColor,t.fillText(o,s,r),r+=i}t.restore()}enhanceDrawWith(t){let e=this.draw;return this.draw=i=>{e.call(this,i),t.call(this,i)},()=>this.draw=e}collideWith(t){return h.yp.intersects(this.getCollideRegion(),t.getCollideRegion())}linearSize(){const t=this.getRegion().getBoundingBox();return Math.max(t[2]-t[0],t[3]-t[1])}}w.idPrefix=function(){var t=new m;if(t.update((new Date).getTime().toString()),window.crypto){var e=new Uint32Array(16);window.crypto.getRandomValues(e);for(let i of e)t.update(i.toString())}else for(var i=0;i<16;i++)t.update(Math.random().toString());return t.update(navigator.userAgent||""),t.update(navigator.language||""),t.update((window.screen.colorDepth||-1).toString()),t.update((window.devicePixelRatio||"").toString()),t.update((new Date).getTimezoneOffset().toString()),t.update(navigator.hardwareConcurrency.toString()||""),t.update(navigator.platform||""),t.update((navigator.hardwareConcurrency||"").toString()),t.hex()}(),w.idIndex=0,w.__type="Entity",y.Z.registerConstructor(w.__type,(t=>new w(t.xy)));class T extends w{constructor(t,e,i,s){super(t),this.m=e,this.size=s,this.v=c.Z.clone(i)}__serialize(){let t=super.__serialize();return t.m=this.m,t.v=this.v,t.size=this.size,t}__unserialize(t){super.__unserialize(t),this.m=t.m,this.v=t.v,this.size=t.size}getRegion(){return new h.kb(this.xy,this.size)}progress(t){const e=c.Z.mulByScalar(this.v,t);this.xy=c.Z.add(this.xy,e)}applyForce(t,e){const i=c.Z.mulByScalar(t,e/this.m);this.v=c.Z.add(this.v,i)}applyRotation(t,e){this.v=c.Z.rotate(this.v,t*e)}}T.__type="Fly",y.Z.registerConstructor(T.__type,(t=>new T(t.xy,t.m,t.v,t.size)));class _ extends T{constructor(t,e,i,s){super(t,e,i,s),this.lastXy=null,this.tail=[],this.lastXy=null,this.progressTrail=!0,this.fadingAlpha=null}__serialize(){return super.__serialize()}_stopTrailing(t){this.progressTrail=!1,o([1],[0],t/10,t,a.linear(0),(t=>this.fadingAlpha=t[0]),null)}progress(t){super.progress(t),this.progressTrail&&(null===this.lastXy&&(this.lastXy=this.xy),c.Z.length(c.Z.subtract(this.xy,this.lastXy))>10&&(this.tail.push(this.xy),this.lastXy=this.xy,this.tail.length>20&&this.tail.splice(0,this.tail.length-20)))}draw(t){if(super.draw(t),null!==this.fadingAlpha&&(t.globalAlpha=this.fadingAlpha),0===this.tail.length)return;const e=r(x.T.trailStartColor,x.T.trailEndColor,1,this.tail.length,a.linear(0));for(let i=1;i<this.tail.length;i++){const s=e(i);t.strokeStyle=(0,x.B)(s),t.beginPath(),t.moveTo(this.tail[i-1][0],this.tail[i-1][1]),t.lineTo(this.tail[i][0],this.tail[i][1]),t.stroke()}if(this.progressTrail){const i=e(this.tail.length);t.strokeStyle=(0,x.B)(i),t.beginPath(),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(this.tail[this.tail.length-1][0],this.tail[this.tail.length-1][1]),t.stroke()}}}_.__type="Trail",y.Z.registerConstructor(_.__type,(t=>new _(t.xy,t.m,t.v,t.size)));class S extends T{constructor(t){super(t,1,[0,-.1],7),this._lifes=1,this._fakeTargets=2,this._score=0,this._booster=1e4,this.layer=100,this.omega=null,this.hangForce=null,this.boostForce=null,this.minVelocity=.01,this.maxVelocity=.1,this.void=!0,s.Z.set((()=>this.void=!1),x.T.planeBirthVoidPeriod)}set lifes(t){t<0&&(t=0);let e=t-this._lifes;this._lifes=t,this.emit(new C(e))}get lifes(){return this._lifes}set fakeTargets(t){t<0&&(t=0);let e=t-this._fakeTargets;this._fakeTargets=t,this.emit(new k(e))}get fakeTargets(){return this._fakeTargets}set score(t){t<0&&(t=0);let e=t-this._score;this._score=t,this.emit(new z(e))}get score(){return this._score}set booster(t){t<0&&(t=0);let e=t-this._booster;this._booster=t,this.emit(new P(e))}get booster(){return this._booster}getCollideRegion(){return this.void?h.yp.EMPTY:super.getCollideRegion()}__serialize(){let t=super.__serialize();return t.maxVelocity=this.maxVelocity,t.omega=this.omega,t.hangForce=this.hangForce,t.boostForce=this.boostForce,t.minVelocity=this.minVelocity,t.maxVelocity=this.maxVelocity,t.void=this.void,t.lifes=this.lifes,t.fakeTargets=this.fakeTargets,t.score=this.score,t.booster=this.booster,t}__unserialize(t){super.__unserialize(t),this.maxVelocity=t.maxVelocity,this.omega=t.omega,this.hangForce=t.hangForce,this.boostForce=t.boostForce,this.minVelocity=t.minVelocity,this.maxVelocity=t.maxVelocity,this.void=t.void,this.lifes=t.lifes,this.fakeTargets=t.fakeTargets,this.score=t.score,this.booster=t.booster}draw(t){super.draw(t);const e=c.Z.normalize(this.v),i=c.Z.subtract(this.xy,c.Z.mulByScalar(e,this.size/7*5)),s=c.Z.add(this.xy,c.Z.mulByScalar(e,this.size/7*10)),r=c.Z.subtract(this.xy,c.Z.mulByScalar(c.Z.normal(e),this.size)),o=c.Z.add(this.xy,c.Z.mulByScalar(c.Z.normal(e),this.size));if(t.lineWidth=3,this.void&&(t.globalAlpha=.2),t.strokeStyle=x.T.planeColor,t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(s[0],s[1]),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(r[0],r[1]),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(o[0],o[1]),t.stroke(),null!==this.boostForce){t.fillStyle=x.T.planeBoosterColor,t.globalAlpha=x.T.planeBoosterAlpha;for(let i=0;i<3;i++){t.beginPath();const s=c.Z.add(c.Z.subtract(this.xy,c.Z.mulByScalar(e,5+this.size/7*5*i/2)),c.Z.random(1));t.arc(s[0],s[1],2/(1+i/2),0,2*Math.PI),t.fill()}}this.fakeTargetRadius&&(t.globalAlpha=.2,t.fillStyle=x.T.planeFakeTargetRadiusColor,t.beginPath(),t.arc(this.xy[0],this.xy[1],this.fakeTargetRadius,0,2*Math.PI),t.fill())}progress(t){if(null!==this.omega&&this.applyRotation(this.omega,t),null!==this.hangForce){const e=c.Z.mulByScalar(c.Z.normalize(this.v),-this.hangForce);this.applyForce(e,t)}if(null!==this.boostForce){const e=c.Z.mulByScalar(c.Z.normalize(this.v),this.boostForce);this.applyForce(e,t)}const e=c.Z.length(this.v);e<this.minVelocity&&(this.v=c.Z.mulByScalar(c.Z.normalize(this.v),this.minVelocity)),e>this.maxVelocity&&(this.v=c.Z.mulByScalar(c.Z.normalize(this.v),this.maxVelocity)),super.progress(t)}left(){this.omega=-.004}right(){this.omega=.004}noRotate(){this.omega=null}startHang(){this.hangForce=1e-4}stopHang(){this.hangForce=null}startBoost(){this.boostForce=1e-4}stopBoost(){this.boostForce=null}showFakeTargetRadius(t){this.fakeTargetRadius=t}hideFakeTargetRadius(){this.fakeTargetRadius=null}}S.__type="Plane",y.Z.registerConstructor(S.__type,(t=>new S(t.xy)));class M extends b{constructor(t){super(),this.amount=t}}class C extends M{}class k extends M{}class z extends M{}class P extends M{}class Z extends T{constructor(t){if(null!==t){const e=c.Z.negate(c.Z.normalize(t.v)),i=2*Math.random()*Math.PI/10,s=i-2*i,r=c.Z.rotate(c.Z.mulByScalar(e,.1+50*Math.random()/1e3),s);super(c.Z.add(t.xy,c.Z.mulByScalar(e,2*t.size)),.1,r,3),this.layer=100,this.omega=.002-2*Math.random()*.002,this.color=x.T.fakeTargetStartColor,o(x.T.fakeTargetStartColor,x.T.fakeTargetEndColor,100,5e3,a.ease(),(t=>this.color=t),null),o([c.Z.length(r)],[0],100,5e3,a.ease(),(t=>this.v=c.Z.mulByScalar(c.Z.normalize(this.v),t[0])),(()=>this.dead=!0))}}__serialize(){let t=super.__serialize();return t.omega=this.omega,t.color=this.color,t}__unserialize(t){this.omega=t.omega,this.color=t.color}progress(t){super.progress(t),this.applyRotation(this.omega,t)}draw(t){super.draw(t),t.strokeStyle=(0,x.B)(this.color),t.beginPath();for(let e=0;e<3;e++){const e=c.Z.random(this.size);t.moveTo(this.xy[0],this.xy[1]),t.lineTo(this.xy[0]+e[0],this.xy[1]+e[1]),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(this.xy[0]-e[0],this.xy[1]-e[1])}t.stroke()}}Z.__type="FakeTarget",y.Z.registerConstructor(Z.__type,(()=>new Z(null)));class I extends _{constructor(t,e){const i=.13;super(t,.1,[0,i+Math.random()*(.15-i)],3),this.layer=100,this.maxSpeed=.15,this.minSpeed=i,this.oldTargets=[],this.target=e,this.maxOmega=.002,this.lifeTime=1e4+3e4*Math.random()}__serialize(){let t=super.__serialize();return t.maxSpeed=this.maxSpeed,t.minSpeed=this.minSpeed,t.maxOmega=this.maxOmega,t.lifeTime=this.lifeTime,t.target=this.target?this.target.id:null,t.oldTargets=this.oldTargets.map((t=>t.id)),t}__unserialize(t){super.__unserialize(t),this.maxSpeed=t.maxSpeed,this.minSpeed=t.minSpeed,this.maxOmega=t.maxOmega,this.lifeTime=t.lifeTime}isDying(){return this.dead||this.dieAnimation}getCollideRegion(){return this.dieAnimation?h.yp.EMPTY:super.getCollideRegion()}progress(t){if(this.lifeTime-=t,this.lifeTime<=0&&(this.dead=!0),!this.dieAnimation&&this.lifeTime<2e3&&(this._stopTrailing(1500),this.dieAnimation=o(x.T.missileDieStartColor,x.T.missileDieEndColor,100,2e3,a.linear(0),null,null)),void 0!==this.target&&(this.target.dead&&(this.target=this.oldTargets.pop()),void 0!==this.target)){const e=c.Z.subtract(this.target.xy,this.xy),i=c.Z.alignUp(e,this.v);this.applyRotation(this.maxOmega*(i[0]>0?1:-1),t)}super.progress(t)}retarget(t){if(this.target===t)return;let e,i=this,s=this.target.enhanceDrawWith((s=>{s.fillStyle="#ff9999",s.globalAlpha=.3,s.strokeStyle="#ff9999",s.beginPath(),s.moveTo(i.xy[0],i.xy[1]),s.lineTo(i.target.xy[0],i.target.xy[1]),s.stroke(),s.beginPath(),s.arc(t.xy[0],t.xy[1],e()[0],0,2*Math.PI),s.fill()}));e=o([50],[0],100,1e3,a.ease(),null,s),this.oldTargets.push(this.target),this.target=t}draw(t){super.draw(t);const e=c.Z.normalize(this.v),i=c.Z.add(this.xy,c.Z.mulByScalar(e,5*this.size/3)),s=c.Z.subtract(this.xy,c.Z.mulByScalar(c.Z.normal(e),2*this.size/3)),r=c.Z.add(this.xy,c.Z.mulByScalar(c.Z.normal(e),2*this.size/3));let o="black";if(this.dieAnimation&&(o=(0,x.B)(this.dieAnimation())),t.strokeStyle=o,t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(i[0],i[1]),t.moveTo(r[0],r[1]),t.lineTo(i[0],i[1]),t.stroke(),!this.dieAnimation){const i=1/(this.maxSpeed-this.minSpeed),s=-this.minSpeed*i,r=c.Z.length(this.v)*i+s;t.fillStyle=(0,x.B)(255*(1-r),0,255*r),t.globalAlpha=.5;for(let i=0;i<3;i++){t.beginPath();const s=c.Z.add(c.Z.subtract(this.xy,c.Z.mulByScalar(e,5*this.size/3*i/2)),c.Z.random(1));t.arc(s[0],s[1],2/(1+i/2),0,2*Math.PI),t.fill()}}}}I.__type="Missile",y.Z.registerConstructor(I.__type,(t=>{let e=new I(t.xy,void 0);return null!==t.target?y.Z.getLink(t.target,(t=>e.target=t),(()=>{})):e.target=new w([1/0,1/0]),y.Z.getLink(t.oldTargets,(t=>e.oldTargets=t),(()=>{})),e}));class A extends b{constructor(t){super(),this.target=t}}class E extends w{constructor(t,e){super(t),this.layer=100,this.size=3,s.Z.set((()=>this.dead=!0),6e4+6e4*e.nextFloat())}__serialize(){let t=super.__serialize();return t.size=this.size,t}__unserialize(t){super.__unserialize(t),this.size=t.size}getRegion(){return new h.kb(this.xy,this.size)}collected(t){this.dead=!0,this.emit(new A(this))}}E.__type="Perk",y.Z.registerConstructor(E.__type,(t=>new E(t.xy,new v.K)));class F extends E{constructor(t,e){super(t,e)}draw(t){super.draw(t),t.strokeStyle=x.T.lifeColor,t.fillStyle=x.T.lifeColor,t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.fill()}collected(t){super.collected(t),t.lifes+=1}}F.__type="Life",y.Z.registerConstructor(F.__type,(t=>new F(t.xy,new v.K)));class B extends E{constructor(t,e){super(t,e)}draw(t){super.draw(t),t.strokeStyle=x.T.scoreColor,t.fillStyle=x.T.scoreColor,t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.fill()}collected(t){super.collected(t),t.score+=1}}B.__type="Star",y.Z.registerConstructor(B.__type,(t=>new B(t.xy,new v.K)));class R extends T{constructor(t,e){super(t,1,[0,0],1),this.layer=100,this.deadCount=e,this.circles=[];let i=0;for(let r=0;r<e;r++){const e=10*this.size-2*Math.random()*10*this.size,r=10*this.size-2*Math.random()*10*this.size,n=[c.Z.add(t,[e,r]),0];s.Z.set((()=>{o([0],[20*this.size],10,1e3,a.ease(),(t=>{n[1]=t[0],this.deadCount--}),(()=>this.dead=this.deadCount<=0))}),i+=100*Math.random()),this.circles.push(n)}this.color=o(x.T.explosionStartColor,x.T.explosionEndColor,100,i+1e3,a.linear(0),null,null),this.particles=[];for(let i=0;i<10*e;i++){const e=c.Z.random(.13+2*Math.random()*.13/3);this.particles.push([t,e])}}__serialize(){let t=super.__serialize();return t.deadCount=this.deadCount,t}__unserialize(t){super.__unserialize(t)}progress(t){this.particles.forEach((e=>e[0]=c.Z.add(e[0],c.Z.mulByScalar(e[1],t))))}getRegion(){return h.yp.EMPTY}draw(t){super.draw(t),t.globalAlpha=x.T.explosionAlpha,t.fillStyle=(0,x.B)(this.color()),this.circles.forEach((e=>{t.beginPath(),t.arc(e[0][0],e[0][1],e[1],0,2*Math.PI),t.fill()})),this.particles.forEach((e=>{t.beginPath(),t.arc(e[0][0],e[0][1],2,0,2*Math.PI),t.fill()}))}}R.__type="Explosion",y.Z.registerConstructor(R.__type,(t=>new R(t.xy,t.deadCount)));class O extends w{constructor(t){super(t)}isStatic(){return!0}}class D extends O{constructor(t){super(t.toPolygonRegion().vertices.reduce(((t,e,i,s)=>[t[0]+e[0]/s.length,t[1]+e[1]/s.length]),[0,0])),this.layer=100,this.region=t}getRegion(){return this.region}draw(t){super.draw(t),this.region.draw(t,x.T.obstacleFillColor,x.T.obstacleStrokeColor)}__serialize(){const t=super.__serialize();return t.region=y.Z.toPojo(this.region),t}__unserialize(t){super.__unserialize(t)}}D.__type="Obstacle",y.Z.registerConstructor(D.__type,(t=>new D(y.Z.unserialize(t.region))));class U extends O{constructor(t,e){if(super(t),this.alpha=1,this.layer=200,this.size=50,this.color=x.T.cloudColor,this.circles=[],null!==e){const i=4+Math.round(6*e.nextFloat());for(let s=0;s<i;s++){const i=c.Z.add(t,c.Z.random(e.nextFloat()*this.size,(()=>e.nextFloat())));this.circles.push([i[0],i[1],e.nextFloat()*this.size])}this.alpha=.1+.4*e.nextFloat(),this.alphaAnim=o([0],[this.alpha],100,1e3,a.linear(0),null,null)}}getCollideRegion(){return h.yp.EMPTY}getRegion(){return h.yp.EMPTY}draw(t){super.draw(t),t.fillStyle=this.color,t.globalAlpha=this.alphaAnim?this.alphaAnim()[0]:this.alpha,this.circles.forEach((e=>{t.beginPath(),t.arc(e[0],e[1],e[2],0,2*Math.PI),t.fill()}))}__serialize(){const t=super.__serialize();return t.xy=this.xy,t.color=this.color,t.alpha=this.alpha,t.circles=this.circles,t.size=this.size,t}__unserialize(t){super.__unserialize(t),this.alpha=t.alpha,this.color=t.color,this.circles=t.circles,this.size=t.size}}U.__type="Cloud",y.Z.registerConstructor(U.__type,(t=>new U(t.xy,null)));class V extends w{constructor(t,e,i,s){super(t),this.message=e,this.color=i,this.layer=300,this.fontSize=o([10],[20],100,s||1e3,a.ease(),null,(()=>this.dead=!0))}getRegion(){return h.yp.EMPTY}draw(t){super.draw(t),t.globalAlpha=.5,t.fillStyle=this.color,t.font=this.fontSize()[0]+"px serif",t.fillText(this.message,this.xy[0],this.xy[1])}}},381:(t,e,i)=>{i.d(e,{Z:()=>n});const s={};class r{constructor(t,e,i){this.pluginId=t,this.dependencies=e,this.plugin=i,this.pluginValue=s}}const o=new Map;let a=!1;const n={register:function(t,e,i){if(o.has(t))throw new Error("Plugin with the id already exists: "+t);o.set(t,new r(t,e,i))},init:function(t){if(a)throw new Error("Calling plugin.init() inside plugin.init()");for(let e of function(){let t,e=[],i=[];o.forEach((t=>i.push(t)));do{t=[];for(let s of i)s.dependencies.filter((t=>-1==e.findIndex((e=>e.pluginId==t)))).length>0||(e.push(s),t.push(s));t.forEach((t=>i.splice(i.indexOf(t),1)))}while(t.length>0);return i.forEach((t=>e.push(t))),e}()){a=!0;try{let i=e.dependencies.filter((t=>o.has(t))).map((t=>o.get(t))).filter((t=>t.pluginValue!==s)).map((t=>t.pluginValue));if(i.length!=e.dependencies.length){let t=e.dependencies.filter((t=>!o.has(t)||o.get(t).pluginValue===s)).map((t=>"function"==typeof t?t.name:t)).map((t=>`'${t}'`)).join(", ");console.log("[PLUGINS]","Missed dependencies",t,"for plugin","'"+("function"==typeof e.pluginId?e.pluginId.name:e.pluginId)+"'.","Not loaded");continue}e.pluginValue=e.plugin(t,...i)}finally{a=!1}}},get:function(t){if(!o.has(t))return;let e=o.get(t).pluginValue;if(e===s)throw new Error("Plugin is not yet initialized: "+t);return e}}},751:(t,e,i)=>{i.d(e,{yp:()=>o,kb:()=>a,OI:()=>l});var s=i(464),r=i(485);class o{constructor(){this.void=!1,this.poly=null,this.boundingBox=null}static intersects(t,e){if(t===o.EMPTY||e==o.EMPTY)return!1;if(t.void||e.void)return!1;if(t instanceof a&&e instanceof a)return s.Z.length(s.Z.subtract(t.xy,e.xy))<t.r+e.r;const i=t.getBoundingBox(),r=e.getBoundingBox();if(i[0]>r[2]||r[0]>r[2])return!1;if(i[1]>r[3]||r[1]>r[3])return!1;const n=t.toPolygonRegion(),l=e.toPolygonRegion();for(const t of n.vertices)if(l.containsPoint(t))return!0;for(const t of l.vertices)if(n.containsPoint(t))return!0;return!1}toPolygonRegion(){return null===this.poly&&(this.poly=this.__toPolygonRegion()),this.poly}getBoundingBox(){if(null===this.boundingBox){const t=this.toPolygonRegion();if(0==t.vertices.length)return[0,0,0,0];let e=1e20,i=-1e20,s=1e20,r=-1e20;for(let o of t.vertices)o[0]<e&&(e=o[0]),o[0]>i&&(i=o[0]),o[1]<s&&(s=o[1]),o[1]>r&&(r=o[1]);this.boundingBox=[e,s,i,r]}return this.boundingBox}getCenter(){const t=this.getBoundingBox();return[(t[0]+t[2])/2,(t[1]+t[3])/2]}__toPolygonRegion(){return l.EMPTY}draw(t,e,i){t.fillStyle=e,t.strokeStyle=this.void?t.fillStyle:i;const s=this.toPolygonRegion();if(0!=s.vertices.length){t.beginPath(),t.moveTo(s.vertices[0][0],s.vertices[0][1]);for(let e=1;e<=s.vertices.length;e++){const i=e%s.vertices.length;t.lineTo(s.vertices[i][0],s.vertices[i][1])}t.fill(),t.beginPath(),t.moveTo(s.vertices[0][0],s.vertices[0][1]);for(let e=1;e<=s.vertices.length;e++){const i=e%s.vertices.length;t.lineTo(s.vertices[i][0],s.vertices[i][1])}t.stroke()}}__serialize(){return{void:this.void}}__unserialize(t){this.void=t.void}moveTo(t){this.boundingBox=null,this.poly=null}}o.__type="Region",o.EMPTY=new o,r.Z.registerConstructor(o.__type,(t=>new o));class a extends o{constructor(t,e){super(),this.xy=t,this.r=e}__toPolygonRegion(){const t=[],e=Math.max(5,Math.min(30,Math.round(2*Math.PI*this.r/5)));for(let i=0;i<e;i++){const s=this.xy[0]+this.r*Math.cos(2*Math.PI/e*i),r=this.xy[1]+this.r*Math.sin(2*Math.PI/e*i);t.push([s,r])}return new l(t)}moveTo(t){super.moveTo(t),this.xy=t}__serialize(){const t=super.__serialize();return t.xy=this.xy,t.r=this.r,t}__unserialize(t){super.__unserialize(t)}}a.__type="CircleRegion",r.Z.registerConstructor(a.__type,(t=>new a(t.xy,t.r)));class n{constructor(t,e,i){this.v0=t,this.v=e,this.direction=this._direction(i)}containsPoint(t){return this.direction*this._direction(t)>=0}_direction(t){if(Math.abs(this.v[0])<1e-6)return Math.sign(t[0]-this.v0[0]);const e=this.v0[1]+(t[0]-this.v0[0])/this.v[0]*this.v[1];return Math.sign(t[1]-e)}__serialize(){return{v0:this.v0,v:this.v,direction:this.direction}}__unserialize(t){this.direction=t.direction}}n.__type="Semispace",r.Z.registerConstructor(n.__type,(t=>new n(t.v0,t.v,[0,0])));class l extends o{constructor(t){super(),this.vertices=t,this.calculateSemispaces()}calculateSemispaces(){const t=this.vertices;this.semispaces=[];for(let e=0;e<t.length;e++){const i=t[e],r=s.Z.subtract(t[(e+1)%t.length],t[e]),o=t[(e+2)%t.length];this.semispaces.push(new n(i,r,o))}}moveTo(t){super.moveTo(t);const e=s.Z.subtract(t,this.getCenter());this.vertices=this.vertices.map((t=>s.Z.add(t,e))),this.calculateSemispaces()}containsPoint(t){for(let e of this.semispaces)if(!e.containsPoint(t))return!1;return!0}__toPolygonRegion(){return this}__serialize(){const t=super.__serialize();return t.vertices=this.vertices,t}__unserialize(t){super.__unserialize(t)}}l.__type="ConvexPolygonRegion",l.EMPTY=new l([]),r.Z.registerConstructor(l.__type,(t=>new l(t.vertices)))},607:(t,e,i)=>{i.d(e,{d:()=>s,H:()=>r});class s{constructor(t){this.startIdx=0,this.endIdx=0,this.size=0,this.buffer=new Array(t)}get(t){if(!(t>=this.size))return this.buffer[(this.startIdx+t)%this.buffer.length]}set(t,e){this.buffer[(this.startIdx+t)%this.buffer.length]=e}push(...t){for(let e of t){const t=this.buffer.length;this.size<t?(this.buffer[this.endIdx++]=e,this.size++):(this.buffer[this.startIdx]=e,this.startIdx=(this.startIdx+1)%t)}}forEach(t){for(let e=0;e<this.size;e++)t(this.get(e),e)}toArray(){const t=new Array(this.size);return this.forEach(((e,i)=>t[i]=e)),t}}class r{constructor(t,e=0){this.buffer=t,this.idx=e}atEnd(){return this.idx==this.buffer.size}next(){if(!this.atEnd())return this.buffer.get(this.idx++)}}},350:(t,e,i)=>{i.d(e,{K:()=>h});const s=256,r=Math.pow(s,6),o=Math.pow(2,52),a=2*o,n=255;class l{constructor(t){this.i=0,this.j=0,this.S=[];let e,i=t.length,r=0,o=0;for(i||(t=[i++]);r<s;)this.S[r]=r++;for(r=0;r<s;r++)e=this.S[r],o=n&o+t[r%i]+e,this.S[r]=this.S[o],this.S[o]=e;this.g(s)}g(t){let e,i=0,r=this.i,o=this.j,a=this.S;for(;t--;)r=n&r+1,o=n&o+a[r],e=a[r],a[r]=a[o],a[o]=e,i=i*s+a[n&a[r]+a[o]];return this.i=r,this.j=o,i}}class h{constructor(t){this.pool=[];const e=[];this.mixkey(this.flatten(null==t?this.autoseed():t,3),e),this.arc4=new l(e),this.mixkey(this.tostring(this.arc4.S),this.pool)}nextFloat(){let t=this.arc4.g(6),e=r,i=0;for(;t<o;)t=(t+i)*s,e*=s,i=this.arc4.g(1);for(;t>=a;)t/=2,e/=2,i>>>=1;return(t+i)/e}flatten(t,e){const i=[];if(e&&"object"==typeof t)for(const s in t)try{i.push(this.flatten(t[s],e-1))}catch(t){}return i.length?i:"string"==typeof t?t:t+"\0"}mixkey(t,e){let i=t+"",s=0,r=0;for(;r<i.length;)e[n&r]=n&(s^=19*e[n&r])+i.charCodeAt(r++);return this.tostring(e)}autoseed(t){return window.crypto.getRandomValues(t=new Uint8Array(s)),this.tostring(t)}tostring(t){return String.fromCharCode.apply(0,t)}}},485:(t,e,i)=>{i.d(e,{Z:()=>h});const s=new Map;function r(t){if(null===t)return null;if(t instanceof Array)return t.map((t=>r(t)));switch(typeof t){case"boolean":case"number":case"string":return t}const e=Object.getPrototypeOf(t);if("function"==typeof t.__serialize&&e.constructor.__type)return{type:e.constructor.__type,data:t.__serialize()};throw new Error("Can't serialize "+t)}let o=0;function a(t){if(null===t)return null;switch(typeof t){case"boolean":case"number":case"string":return t}if(t.type){let e=s.get(t.type);if(void 0===e)throw new Error("No constructor registered for type: "+t.type);let i=e(t.data);return i.__unserialize(t.data),i}throw new Error("'type' expected. Can't unserialize "+t)}let n=[];function l(t,e){for(let i of e){let e=i.get(t);if(void 0!==e)return e}}const h={toPojo:r,serialize:function(t){return JSON.stringify(r(t))},registerConstructor:function(t,e){if(s.has(t))throw new Error("The constructor already exist: "+t);s.set(t,e)},unserialize:function(t){try{o++;let e="string"==typeof t?JSON.parse(t):t;return e instanceof Array?e.map((t=>a(t))):a(e)}finally{o--}},unserializeExisting:function(t,e){if(!e.type)throw new Error("Can't unserialize "+e);t.__unserialize(e.data)},getLink:function(t,e,i){if(i=i||(()=>{}),0==o)throw new Error("getLink can only be called inside __unserialize method");n.push({id:t,consumer:e,defaultProducer:i})},resetLinks:function(){n=[]},resolveLinks:function(...t){if(0!=o)throw new Error("resolveLinks can only be called outside __unserialize mathod");n.forEach((e=>{let i;if(e.id instanceof Array)i=e.id.map((i=>{let s=l(i,t);if(void 0===s){if(!e.defaultProducer)throw new Error("Unresolved link: "+e.id);s=e.defaultProducer()}}));else if(i=l(e.id,t),void 0===i){if(!e.defaultProducer)throw new Error("Unresolved link: "+e.id);i=e.defaultProducer()}e.consumer(i)}))}}},165:(t,e,i)=>{function s(t,...e){return t instanceof Array?(t=t.join("{}"),(r[t]||t).split("{}").map(((t,i,s)=>t+(s.length-1==i?"":e[i]))).join("")):r[t]||t}i.d(e,{t:()=>s,T:()=>r,B:()=>o});const r={booster:"🚀",boosterColor:"black",score:"★",scoreColor:"green",time:"🕐",timeColor:"black",fakeTarget:"☔",fakeTargetColor:"black",fakeTargetStartColor:[255,0,0],fakeTargetEndColor:[255,200,200],fakeTargetRadius:200,life:"❤",lifeColor:"#ff471a",planeColor:"black",planeBoosterColor:"#ff3333",planeBoosterAlpha:.5,planeStartPos:[0,0],planeFakeTargetRadiusColor:"#cccccc",planeBirthVoidPeriod:4e3,trailStartColor:[255,255,255],trailEndColor:[200,200,200],missileDieStartColor:[0,0,0],missileDieEndColor:[255,255,255],explosionStartColor:[255,0,0],explosionEndColor:[255,200,200],explosionAlpha:.5,obstacleFillColor:"#cccccc",obstacleStrokeColor:"#333333",skyColor:"#f0ffff",skyOutOfRangeColor:"#fff0f0",cloudColor:"#eeeeee",radarFillColor:"#fff2e6",radarStrokeColor:"#663300",radarSectorColor:"#ffcc99",radarVisibilityAreaColor:"#999999",radarPlaneColor:"#663300",radarMissileColor:"#ff0000",radarPerkColor:"#000000",radarEnemyColor:"#0000ff",radarAlpha:.9,radarSize:100,radarScale:20,infoFontSize:15,infoBgColor:"#ffff88",infoColor:"#000000",infoAlpha:.8,telemetrySamplesPerSecond:5,telemetryWindowSeconds:10,detectorIntervalMs:300};function o(t,e,i){if(void 0===e&&void 0===i){const e=t;return`rgb(${e[0]}, ${e[1]}, ${e[2]})`}return`rgb(${t}, ${e}, ${i})`}},658:(t,e,i)=>{i.d(e,{N:()=>a});var s=i(607),r=i(349),o=i(464);class a{constructor(t,e,i){this.interval=t,this.game=e,this.capacity=i,this.lastTime=0,this.time=0,this.lastClosestMissile=null,this.planeState=new s.d(this.capacity),this.missileState=new s.d(this.capacity)}toTrigger(){return t=>this.progress(t)}progress(t){this.time+=t,this.time-this.lastTime>=this.interval&&(this.lastTime=this.time,this._collect())}_collect(){let t=1e20,e=null;const i=this.game.plane;for(let s of this.game.flies)if(s instanceof r.Cp){const r=i.xy[0]-s.xy[0],o=i.xy[1]-s.xy[1],a=r*r+o*o;a<t&&(t=a,e=s)}let s=!1;this.lastClosestMissile!==e&&(null!==this.lastClosestMissile&&this.lastClosestMissile.isDying()&&(s=!0),this.lastClosestMissile=e),this.planeState.push({t:this.time,xy:i.xy,v:o.Z.normalize(i.v)}),null!==e?this.missileState.push({t:this.time,xy:e.xy,v:o.Z.normalize(e.v),lastMissileIsDead:s}):this.missileState.push({t:this.time,xy:[1/0,1/0],v:[0,0],lastMissileIsDead:s})}getLatestPlaneState(){return this.planeState.size>0?this.planeState.get(this.planeState.size-1):null}getLatestMissileState(){return this.missileState.size>0?this.missileState.get(this.missileState.size-1):null}}},925:(t,e,i)=>{i.d(e,{Z:()=>p});let s=0;const r=[],o=new Map;let a=!1,n=0,l=!1;function h(t,e,i){return void 0===i&&(s++,i=s),c({id:i,time:n+e,duration:e,f:t,paused:!1,progressBeforePause:0}),i}function c(t){let e;for(e=0;e<r.length&&!(r[e].time>t.time);e++);o.set(t.id,t),r.splice(e,0,t)}function d(t){const e=o.get(t);return void 0===e?0:e.paused?e.progressBeforePause:0===e.duration?0:1-(e.time-n)/e.duration}function u(t){let e=o.get(t);if(void 0===e)return;if(e.paused)return;e.progressBeforePause=d(t),e.paused=!0;let i=r.findIndex((e=>e.id===t));r.splice(i,1)}function f(t){let e=o.get(t);void 0!==e&&e.paused&&(e.time=n+(1-e.progressBeforePause)*e.duration,e.paused=!1,e.progressBeforePause=0,c(e))}function g(t){return function(){if(!l)return t.apply(null,arguments);setTimeout((()=>t.apply(null,arguments)),0)}}const p={set:h,periodic:function t(e,i,s){let r=h((()=>{e(),t(e,i,r)}),i,s);return r},clear:g((function(t){let e=r.findIndex((e=>e.id===t));-1!==e&&(r.splice(e,1),o.delete(t))})),clearAll:g((function(){o.clear(),r.splice(0,r.length),a=!1})),pause:g(u),pauseAll:g((function(){for(let[t,e]of o)u(t);a=!0})),resume:g(f),resumeAll:g((function(){for(let[t,e]of o)f(t);a=!1})),allPaused:()=>a,getProgress:d,progress:function(t){if(n+=t,!a){l=!0;try{!function(){if(a)return;let t;for(t=0;t<r.length&&!(r[t].time>n);t++);t>0&&r.splice(0,t).forEach((t=>t.f()))}()}finally{l=!1}}},now:()=>n}},464:(t,e,i)=>{i.d(e,{Z:()=>r});const s={add:(t,e)=>t.map(((t,i)=>t+e[i])),negate:t=>t.map((t=>-t)),subtract:(t,e)=>s.add(t,s.negate(e)),length:t=>Math.sqrt(t.map((t=>t*t)).reduce(((t,e)=>t+e),0)),normalize:t=>s.mulByScalar(t,1/s.length(t)),mulByScalar:(t,e)=>t.map((t=>t*e)),dotProduct:(t,e)=>t.map(((t,i)=>t*e[i])).reduce(((t,e)=>t+e),0),clone:t=>t.slice(0),random:(t,e=(()=>Math.random()))=>{let i=void 0===t?1:t,s=e()*Math.PI*2;return[i*Math.sin(s),i*Math.cos(s)]},normal:t=>{let e=s.length(t),i=s.normalize(t);return[e*-i[1],e*i[0]]},rotate:(t,e)=>[t[0]*Math.cos(e)-t[1]*Math.sin(e),t[1]*Math.cos(e)+t[0]*Math.sin(e)],alignUp:(t,e)=>{const i=s.length(t),r=t[0]/i,o=t[1]/i;return[e[0]*o-e[1]*r,e[1]*o+e[0]*r]},angle:(t,e)=>{const i=s.dotProduct(t,e)/s.length(t)/s.length(e);return 180*Math.acos(i)/Math.PI},dist:(t,e)=>s.length(s.subtract(t,e)),behind:(t,e,i)=>{const r=s.normal(t);if(Math.abs(r[0])<1e-6)return i[1]<Math.sign(r[1])*e[1];const o=i[0],a=r[1]*(o-e[0])/r[0]+e[1],n=t[0]+e[0],l=r[1]*(n-e[0])/r[0]+e[1];return Math.sign(a-i[1])!=Math.sign(l-e[1])}},r=s}},n={};function l(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return a[t](i,i.exports,l),i.exports}l.d=(t,e)=>{for(var i in e)l.o(e,i)&&!l.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t=l(165);class e{constructor(){this.keyUp=new Map,this.keyDown=new Map,this.mouseUp=new Map,this.mouseDown=new Map,this.mouseLeave=new Map,this.mouseMoveAction=new Map,this.mouseZoomAction=new Map,this.doubleclickAction=new Map,this._next=null}clone(){const t=new e;return t.keyUp=new Map(this.keyUp),t.keyDown=new Map(this.keyDown),t.mouseUp=new Map(this.mouseUp),t.mouseDown=new Map(this.mouseDown),t.mouseLeave=new Map(this.mouseLeave),t.mouseMoveAction=new Map(this.mouseMoveAction),t.mouseZoomAction=new Map(this.mouseZoomAction),t.doubleclickAction=new Map(this.doubleclickAction),null!=this._next&&(t._next=this._next.clone()),t}}let i=new Set,s=null,r=new e;function o(t,e){let i=r;do{let s=t(i);if(s.has(e))return s.get(e);i=i._next}while(null!==i);return null}function a(t,e){return(void 0===t[e]?"":t[e]).toString()+","+t.altKey.toString()+","+t.ctrlKey.toString()+","+t.metaKey.toString()+","+t.shiftKey.toString()}const n=[t.t`Left`,t.t`Middle`,t.t`Right`];function h(e){let i=e.split(","),s=parseInt(i[0]);return("true"==i[1]?"Alt + ":"")+("true"==i[2]?"Ctrl + ":"")+("true"==i[3]?"Win + ":"")+("true"==i[4]?"Shift + ":"")+(n[s]?n[s]:(0,t.t)(i[0]).replace(/^Key/,""))}window.onkeydown=t=>{if(i.has(t.code))return;i.add(t.code);let e=o((t=>t.keyDown),a(t,"code"));e&&(t.preventDefault(),e.callback(t))},window.onkeyup=t=>{i.delete(t.code);let e=o((t=>t.keyUp),a(t,"code"));e&&(t.preventDefault(),e.callback(t))};const c=function(t,e,i,s,o){const n=a({code:t.toString(),altKey:-1!==e.indexOf("Alt"),ctrlKey:-1!==e.indexOf("Ctrl"),metaKey:-1!==e.indexOf("Win")||-1!==e.indexOf("Meta"),shiftKey:-1!==e.indexOf("Shift")},"code");s&&r.keyDown.set(n,{description:i,callback:s}),o&&r.keyUp.set(n,{description:i,callback:o})},d=function(){const t=t=>{let e=[];for(let[i,s]of function*(t){let e=new Set;for(let i=r;null!=i;i=i._next){let s=t(i);for(let[t,i]of s)e.has(t)||(e.add(t),yield[t,i])}}(t))e.push({description:s.description,button:i});return e};return{keys:t((t=>t.keyDown)).map((({button:t,description:e})=>h(t)+": "+e)),mouse:t((t=>t.mouseUp)).map((({button:t,description:e})=>h(t)+": "+e)).concat(t((t=>t.mouseZoomAction)).map((({button:t,description:e})=>h(t)+"Wheel: "+e)))}},u=function(t){s=t,s.onmousedown=t=>{t.preventDefault();let e=o((t=>t.mouseDown),a(t,"button"));e&&e.callback(t)},s.onmousemove=t=>{t.preventDefault();let e=o((t=>t.mouseMoveAction),a(t,""));e&&e.callback(t)},s.onmouseup=t=>{t.preventDefault();let e=o((t=>t.mouseUp),a(t,"button"));e&&e.callback(t)},s.ondblclick=t=>{t.preventDefault();let e=o((t=>t.doubleclickAction),a(t,""));e&&e.callback(t)},window.oncontextmenu=t=>t.preventDefault(),s.addEventListener("wheel",(t=>{t.preventDefault();let e=o((t=>t.mouseZoomAction),a(t,""));e&&e.callback(t)}),!1),s.addEventListener("mouseleave",(t=>{t.preventDefault();let e=o((t=>t.mouseLeave),"");e&&e.callback(t)}))},f=()=>{let t=new e;t._next=r,r=t},g=()=>r.clone(),p=t=>{r=t},m=()=>{for(;null!==r._next;)r=r._next};var y=l(381),x=l(925),v=l(349),b=l(464);class w{constructor(){this.level=1,this.missileMaxCount=1,this.missileProbability=.5,this.missilePeriod=1e3,this.outOfRangeRadius=6e3}init(t){this.game=t,this.tryToCreate(v.Cp,(()=>this.missileProbability),(()=>this.missileMaxCount),(()=>{const e=t.gameMap.visibleSize,i=2*t.gameMap.visibleSize,s=b.Z.add(t.plane.xy,b.Z.random(e+Math.random()*(i-e)));return new v.Cp(s,t.plane)}),(()=>this.missilePeriod)),T(this.game,10,(()=>this.game.plane.lifes+=1)),T(this.game,5,(()=>this.game.plane.fakeTargets+=1)),T(this.game,2,(()=>this.game.plane.booster+=2e3))}progress(t){switch(b.Z.length(this.game.plane.xy)>this.outOfRangeRadius&&(this.game.outOfRange=!0,this.level=1/0,this.missileMaxCount=100,this.missileProbability=1),this.level){case 1:(this.game.plane.score>4||this.game.globalTime>3e4)&&(this.level=2,this.missileMaxCount=2);break;case 2:this.game.globalTime>6e4&&(this.level=3,this.missileMaxCount=3,this.missileProbability=1)}}onDeadMissile(e){this.game.plane.score+=1,this.game.achivement(t.t`+1`,t.T.scoreColor,2e3,e)}tryToCreate(t,e,i,s,r,o){if(o&&(this.game.localMode||this.game.masterGameNode)&&Math.random()<e()&&this.game.flies.filter((e=>e instanceof t)).length<i()){let t,e;do{t=s(),e=!1;for(const i of this.game.flies)i.collideWith(t)&&(e=!0);if(!e)for(const i of this.game.gameMap.find(t.xy,t.linearSize()))i.collideWith(t)&&(e=!0)}while(e);this.game.addEntity(t)}x.Z.set((()=>this.tryToCreate(t,e,i,s,r,!0)),r())}}function T(t,e,i){let s=t.plane.score;t.plane.subscribe((r=>{r instanceof v.Vz&&t.plane.score-s>=e&&(s=t.plane.score,i())}))}function _(e,i){let s;i&&(s=g(),m(),c("Space",[],t.t`Hide the message`,(()=>a())),c("Escape",[],t.t`Hide the message`,(()=>a())),c("Enter",[],t.t`Hide the message`,(()=>a())));let r=document.getElementById("message");r.innerHTML="";let o=document.createElement("div");function a(){document.getElementById("message").style.display="none",void 0!==s&&p(s),i&&i()}return o.innerText=e,r.appendChild(o),r.style.display="block",o.onclick=()=>a(),a}class S{constructor(t){this.r=t,this.map=new Map}insert(t,e,i){let s=Math.floor((t[0]-e)/this.r),r=Math.floor((t[0]+e)/this.r),o=Math.floor((t[1]-e)/this.r),a=Math.floor((t[1]+e)/this.r);for(let t=s,e=s*this.r;t<=r;t++,e+=this.r)for(let e=o,s=o*this.r;e<=a;e++,s+=this.r){let s=this.map.get(t);s||(s=new Map,this.map.set(t,s));let r=s.get(e);r||(r=new Set,s.set(e,r)),r.add(i)}}find(t,e){let i=Math.floor((t[0]-e)/this.r),s=Math.floor((t[0]+e)/this.r),r=Math.floor((t[1]-e)/this.r),o=Math.floor((t[1]+e)/this.r),a=new Set;for(let t=i;t<=s;t++)for(let e=r;e<=o;e++){let i=this.map.get(t);if(!i)continue;let s=i.get(e);s&&s.forEach((t=>a.add(t)))}return a}remove(t,e,i){let s=Math.floor((t[0]-e)/this.r),r=Math.floor((t[0]+e)/this.r),o=Math.floor((t[1]-e)/this.r),a=Math.floor((t[1]+e)/this.r);for(let t=s;t<=r;t++)for(let e=o;e<=a;e++){let s=this.map.get(t);if(!s)return;let r=s.get(e);if(!r)return;r.delete(i)}}}var M=l(751),C=l(350),k=l(485);class z extends v.MB{constructor(t){super(t.getCenter()),this.region=t,this.triggered=!1}getRegion(){return this.region}getCollideRegion(){return M.yp.EMPTY}progress(t){const e=this.getGame();if(null===e)return;const i=M.yp.intersects(e.plane.getRegion(),this.region);!this.triggered&&i?(this.triggered=!0,this.onTrigger()):this.triggered&&!i&&(this.triggered=!1)}__serialize(){const t=super.__serialize();return t.region=k.Z.toPojo(this.region),t.triggered=this.triggered,t}__unserialize(t){super.__unserialize(t),this.triggered=t.triggered}}class P extends z{constructor(t,e){super(t),this.callback=e}onTrigger(){this.callback(this.getGame())}__serialize(){const t=super.__serialize();return t.callback=this.callback.toString(),t}__unserialize(t){super.__unserialize(t)}}function Z(t,e,i){return`parts[${t},${e},${i}]`}P.__type="CallbackTrigger",k.Z.registerConstructor(P.__type,(t=>{const e=k.Z.unserialize(t.region),i=new Function("game",'"use strict";('+t.callback+")(game)");return new P(e,i)}));class I{load(t,e,i,s,r){const o=localStorage.getItem(Z(t,e,i));if(null===o)return null;k.Z.resetLinks();const a=k.Z.unserialize(o),n=new Map;return n.set("rng",s),n.set("game",r),k.Z.resolveLinks(n),a}save(t,e,i,s){localStorage.setItem(Z(t,e,i),k.Z.serialize(s))}}var A=function(t,e,i,s){return new(i||(i=Promise))((function(r,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function n(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,n)}l((s=s.apply(t,e||[])).next())}))};class E{constructor(t,e,i,s){this.game=t,this._visibleSize=i,this.gameSeed=s,this.parts=new Map,this.deadStatics=new Set,this.rng=null,this.partsStore=new I,this.tree=new S(e)}get visibleSize(){return this._visibleSize}find(t,e){return this.tree.find(t,e)}iAmHere(t){const e=Math.floor(t[0]/this._visibleSize),i=Math.floor(t[1]/this._visibleSize);if(this.privPx==e&&this.privPy==i)return;const s=new Set,r=[];for(let t of[0,-1,1])for(let o of[0,-1,1]){const a=e+t,n=i+o;s.add(`${a},${n}`),void 0===(this.parts.has(a)?this.parts.get(a).get(n):void 0)&&r.push(this.loadPart(a,n))}const o=this.privPx,a=this.privPy;this.privPx=e,this.privPy=i,Promise.all(r).then((t=>{for(let t of[-1,0,1])for(let e of[-1,0,1]){const i=o+t,r=a+e;if(s.has(`${i},${r}`))continue;const n=this.parts.get(i);if(void 0===n)continue;const l=n.get(r);if(l){for(const t of l)this.remove(t);n.delete(r),0==n.size&&this.parts.delete(i)}}}))}withTemporaryEntity(t,e){const i=Math.floor(t.xy[0]/this._visibleSize),s=Math.floor(t.xy[1]/this._visibleSize);this.add(i,s,t),e(),this.remove(t)}addEntityAndSave(t){const e=Math.floor(t.xy[0]/this._visibleSize),i=Math.floor(t.xy[1]/this._visibleSize);this.add(e,i,t),this.partsStore.save(this.gameSeed,e,i,this.parts.get(e).get(i))}removeEntityAndSave(t){const e=Math.floor(t.xy[0]/this._visibleSize),i=Math.floor(t.xy[1]/this._visibleSize);this.remove(t),this.partsStore.save(this.gameSeed,e,i,this.parts.get(e).get(i))}loadPart(t,e){return A(this,void 0,void 0,(function*(){return this.tryLoadPart(t,e).then((i=>{if(i&&console.log("Loaded",t,e),!i)return new Promise((i=>{this.rng=new C.K(`${t},${e},${this.gameSeed}`),this.generate(t,e),i(null)}))}))}))}tryLoadPart(t,e){return A(this,void 0,void 0,(function*(){return new Promise((i=>{const s=this.partsStore.load(this.gameSeed,t,e,this.rng,this.game);if(s){for(let i of s)this.add(t,e,i);i(!0)}else{if(0==t&&-1==e)return this.add(t,e,new P(new M.kb([0,0],20),(t=>console.log("Triggered")))),console.log("Customer generated",t,e),this.partsStore.save(this.gameSeed,t,e,this.parts.get(t).get(e)),void i(!0);i(!1)}}))}))}randomXy(t,e){return[(t+this.rng.nextFloat())*this._visibleSize,(e+this.rng.nextFloat())*this._visibleSize]}generate(t,e){this.tryToCreate(t,e,1*this._visibleSize/2e3,(()=>{const i=new v.Ux(this.randomXy(t,e),this.rng);return i.subscribe((t=>this.onCollected(t))),i})),this.tryToCreate(t,e,1*this._visibleSize/4e3,(()=>{const i=new v.Vk(this.randomXy(t,e),this.rng);return i.subscribe((t=>this.onCollected(t))),i})),this.randomObstacles(t,e,4*this._visibleSize/1e3),this.randomClouds(t,e,10*this._visibleSize/500),console.log("Generated",t,e)}entityKey(t){return`${Object.getPrototypeOf(t).constructor.__type},${t.xy[0]},${t.xy[1]}`}onCollected(t){this.deadStatics.add(this.entityKey(t.target)),this.remove(t.target)}tryToCreate(t,e,i,s){const r=Math.floor(this.rng.nextFloat()*(i+1));for(let i=0;i<r;i++){let i,r;do{i=s(),r=!1;for(const t of this.tree.find(i.xy,i.linearSize()))t.collideWith(i)&&(r=!0)}while(r);this.add(t,e,i)}}randomObstacles(t,e,i){const s=Math.floor(this.rng.nextFloat()*(i+1));for(let i=0;i<s;i++){let i,s=!1;do{let r=this.randomXy(t,e),o=20+30*this.rng.nextFloat();const a=Math.round(3+10*this.rng.nextFloat()),n=[];for(let t=0;t<a;t++){const e=o*Math.cos(2*Math.PI/a*t),i=o*Math.sin(2*Math.PI/a*t);n.push([r[0]+e,r[1]+i])}i=new v.JA(new M.OI(n)),s=!1;for(let t of this.tree.find(r,o))t.collideWith(i)&&(s=!0)}while(s);this.add(t,e,i)}}randomClouds(t,e,i){const s=Math.floor(this.rng.nextFloat()*(i+1));for(let i=0;i<s;i++)this.add(t,e,new v.ZJ(this.randomXy(t,e),this.rng))}remove(t){t.setGame(null);t:for(let[e,i]of this.parts)for(let[e,s]of i){if(!s)continue;const e=s.indexOf(t);if(e>=0){s.splice(e,1);break t}}this.tree.remove(t.xy,t.linearSize(),t)}add(t,e,i){if(this.deadStatics.has(this.entityKey(i)))return;i.setGame(this.game),this.tree.insert(i.xy,i.linearSize(),i);let s=this.parts.get(t);void 0===s&&this.parts.set(t,s=new Map);let r=s.get(e);void 0===r&&s.set(e,r=[]),r.push(i)}*all(){for(let[t,e]of this.parts)for(let[t,i]of e)if(i)for(let t of i)yield t}drawParts(t){t.strokeStyle="#cccccc";for(let[e,i]of this.parts)for(let[s,r]of i)t.strokeRect(e*this._visibleSize,s*this._visibleSize,this._visibleSize,this._visibleSize)}}class F{constructor(t,e=!0,i){this.ctx=t,this.localMode=e,this.userId=i,this.masterGameNode=!1,this.frameCallback=null,this.gameOverCallback=null,this.newGameCallback=null,this.paused=!1,this.gameIsOver=!1,this.inbetween=!1,this.radarCtx=null,this._init()}startFromTheBeginning(){this.paused=!0,x.Z.clearAll(),this.flies=[],this.fliesById=new Map,this.fliesToAddAfterTick=[],this.overlays=[],this.triggers=[],this.gameIsOver=!1,this.inbetween=!1,this.lastT=null,this.timeScale=1,this.boosterIsUsed=!1,this.globalTime=0,this.rotationDirection=null,this.fakeTargetTimerId=null,this.outOfRange=!1,this.fps=0,this.plane=new v.JO(t.T.planeStartPos),this.plane.subscribe((t=>this._onPlaneEvent(t))),this.userId&&(this.plane.id=this.userId),this.level=new w,this.gameMap=new E(this,200,1e3,"first game"),this.addEntity(this.plane),this.level.init(this),y.Z.init(this),this.resume()}_onPlaneEvent(e){e instanceof v.$7&&(e.amount>0&&this.achivement(t.t`${t.T.life} +${e.amount}`,t.T.lifeColor,2e3,e.target),e.target.lifes<=0&&this.explosionFor(e.target)),e instanceof v.gF&&e.amount>0&&e.target.addInfo("fake targerts",(()=>t.t`${t.T.fakeTarget} +${e.amount}`),3e3,t.T.fakeTargetColor),e instanceof v.qF&&e.amount>0&&e.target.addInfo("booster",(()=>t.t`${t.T.booster} +${Math.round(e.amount/1e3)}`),3e3,t.T.boosterColor)}achivement(t,e,i,s){this.addEntity(new v.PE((s||this.plane).xy,t,e,i))}addInfo(t,e,i,s){this.plane.addInfo(t,e,i,s)}removeInfo(t){this.plane.removeInfo(t)}addEntity(t){if(t instanceof v.MB)throw new Error("Static entities can't be added here");t.setGame(this),this.inbetween?this.fliesToAddAfterTick.push(t):(this.flies.push(t),this.fliesById.set(t.id,t),this._sort())}_addNewFlies(){this.fliesToAddAfterTick.length>0&&(this.fliesToAddAfterTick.forEach((t=>{this.flies.push(t),this.fliesById.set(t.id,t)})),this._sort(),this.fliesToAddAfterTick=[])}_sort(){this.flies.sort(((t,e)=>t.layer>e.layer?1:t.layer==e.layer?0:-1))}addTrigger(t){this.triggers.push(t)}addOverlay(t){return this.overlays.push(t),()=>{const e=this.overlays.indexOf(t);e>=0&&this.overlays.splice(e,1)}}_init(){var e,i;m(),f(),e=()=>this.pause(),i=()=>this.resume(),c("F1",[],t.t`Show this help message (F1 again to hide)`,(()=>{e&&e();let s,r=document.getElementById("help");const o=()=>{p(s),r.style.display="none",i&&i()};if("block"==r.style.display)return void o();let a=d();s=g(),m(),c("Escape",[],t.t`Hide help message`,(()=>o())),c("F1",[],t.t`Hide help message`,(()=>o())),r.innerHTML="<h2>"+t.t`Keyboard`+"</h2>\n<pre>"+a.keys.join("\n</pre><pre>")+"</pre>",r.style.display="block"})),c("ArrowRight",[],t.t`Turn right`,(()=>{this.rotationDirection="right",this.plane.right()}),(()=>{"right"==this.rotationDirection&&this.plane.noRotate()})),c("ArrowLeft",[],t.t`Turn left`,(()=>{this.rotationDirection="left",this.plane.left()}),(()=>{"left"==this.rotationDirection&&this.plane.noRotate()})),c("KeyF",[],t.t`Fast/Unfast`,(()=>{this.timeScale<1?this.timeScale=1:this.timeScale=Math.max(this.timeScale/1.8,.01)})),c("KeyS",[],t.t`Slowmo/Unslowmo`,(()=>{this.timeScale>1?this.timeScale=1:this.timeScale=Math.min(2.5*this.timeScale,10)})),c("ArrowUp",[],t.t`Boost/Unboost`,(()=>{this.boosterIsUsed?(this.plane.maxVelocity=.1,this.plane.stopBoost()):(this.plane.maxVelocity=this.plane.booster>0?.15:.1,this.plane.startBoost()),this.boosterIsUsed=!this.boosterIsUsed})),c("ArrowDown",[],t.t`Unboost`,(()=>{this.boosterIsUsed&&(this.plane.maxVelocity=.1,this.plane.stopBoost(),this.boosterIsUsed=!1)})),c("Escape",[],t.t`Start from the beginning`,(()=>this.gameOver(0))),c("KeyP",[],t.t`Pause`,(()=>{this.gameIsOver||(this.pause(),_(t.t`Paused`,(()=>this.resume())))})),c("Space",[],t.t`Launch fake targets`,(()=>this.launchFakeTarget()))}frame(t){if(!this.paused){this.inbetween=!0;try{null===this.lastT&&(this.lastT=t);let e=t-this.lastT;x.Z.progress(e),this.fps=e>0?(100*this.fps+1e3/e)/101:0,e/=this.timeScale,this.lastT=t,this.globalTime+=e,this.gameMap.iAmHere(this.plane.xy),this.level.progress(e),this.updateBooster(e),this.progress(e),this._detectCollision(),this.triggers.forEach((t=>t(e))),this._removeDead(),this._addNewFlies(),this.draw(),this.frameCallback&&this.frameCallback(),requestAnimationFrame((t=>this.frame(t)))}finally{this.inbetween=!1}}}updateBooster(t){this.boosterIsUsed&&(this.plane.booster-=t,this.plane.booster<=0&&(this.plane.booster=0,this.boosterIsUsed=!1,this.plane.maxVelocity=.1,this.plane.stopBoost()))}progress(t){const e=e=>e.progress(t);for(let t of this.flies)e(t);for(let t of this.gameMap.all())e(t)}_detectCollision(){if(this.localMode||this.masterGameNode)for(let t=0;t<this.flies.length;t++){const e=this.flies[t];for(let i=t+1;i<this.flies.length;i++){const t=this.flies[i];this.tryCollide(e,t)}for(const t of this.gameMap.find(e.xy,e.linearSize()))this.tryCollide(e,t)}}tryCollide(t,e){if(t!==e&&!(t instanceof v.JA&&e instanceof v.JA)&&t.collideWith(e)){if(t instanceof v.JO&&e instanceof v.JO)return t.lifes=1,e.lifes=1,t.lifes-=1,void(e.lifes-=1);if(t instanceof v.JO||e instanceof v.JO){const i=t instanceof v.JO?e:t,s=t instanceof v.JO?t:e;if(i instanceof v.Hs)return void i.collected(s);i instanceof v.JA?s.lifes=1:this.explosionFor(i),s.lifes-=1}else t instanceof v.Cp&&this.level.onDeadMissile(t),e instanceof v.Cp&&this.level.onDeadMissile(e),t instanceof v.JA||this.explosionFor(t),e instanceof v.JA||this.explosionFor(e)}}_removeDead(){const t=this.flies.filter((t=>t.dead));if(t.length>0){let e=!1;t.forEach((t=>{t===this.plane&&(e=!0),this.flies.splice(this.flies.indexOf(t),1).forEach((t=>{t.setGame(null),this.fliesById.delete(t.id)}))})),e&&this.gameOver()}}gameOver(e){this.gameIsOver=!0,null!==this.gameOverCallback&&this.gameOverCallback();const i=setTimeout((()=>{this.pause(),_(t.t`Game Over`,(()=>{clearTimeout(i),null!==this.newGameCallback?this.newGameCallback():this.startFromTheBeginning()}))}),void 0!==e?e:2e3)}explosionFor(t){t.dead=!0,this.addEntity(new v.OQ(t.xy,t instanceof v.JO?5:1))}draw(){this.ctx.fillStyle=this.outOfRange?t.T.skyOutOfRangeColor:t.T.skyColor,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.overlays.forEach((t=>t.drawPre&&t.drawPre(this.ctx))),this.ctx.restore(),this.ctx.save(),this.ctx.translate(-this.plane.xy[0]+this.ctx.canvas.width/2,-this.plane.xy[1]+this.ctx.canvas.height/2),this.flies.forEach((t=>{this.ctx.save(),t.draw(this.ctx),this.ctx.restore()}));for(const t of this.gameMap.all())this.ctx.save(),t.draw(this.ctx),this.ctx.restore();this.ctx.save(),this.overlays.forEach((t=>t.drawOverMap(this.ctx))),this.ctx.restore(),this.ctx.restore(),this.ctx.save(),this._drawScore(this.ctx),this.ctx.restore(),this.ctx.save(),this._drawRadar(this.ctx),this.ctx.restore(),this.ctx.save(),this.overlays.forEach((t=>t.drawPost&&t.drawPost(this.ctx))),this.ctx.restore()}_drawScore(e){const i=14*1.1;let s=i;e.font="14px serif",e.fillStyle="black",e.fillText("FPS: "+Math.round(this.fps),0,s),s+=i,e.fillStyle=t.T.timeColor,e.fillText(t.t`${t.T.time} ${Math.round(this.globalTime/1e3)}`,0,s),s+=i,e.fillStyle=t.T.scoreColor,e.fillText(t.t`${t.T.score} ${this.plane.score}`,0,s),s+=i,e.fillStyle=t.T.fakeTargetColor,e.fillText(t.t`${t.T.fakeTarget} ${this.plane.fakeTargets}`,0,s),s+=i,e.fillStyle=t.T.boosterColor,e.fillText(t.t`${t.T.booster} ${Math.round(this.plane.booster/1e3)}`,0,s),s+=i,e.fillStyle=t.T.lifeColor,e.fillText(t.t`${t.T.life} ${this.plane.lifes}`,0,s),s+=i}_drawRadar(e){const i=t.T.radarSize,s=t.T.radarScale;if(!this.radarCtx){const t=document.createElement("canvas");t.width=2*i+5,t.height=2*i+5,this.radarCtx=t.getContext("2d")}const r=this.radarCtx,o=r.canvas.width,a=r.canvas.height;r.save(),r.clearRect(0,0,o,a);const n=e.canvas.height/e.canvas.width;r.scale(1,n);const l=o/2,h=a/2;r.fillStyle=t.T.radarFillColor,r.strokeStyle=t.T.radarStrokeColor,r.beginPath(),r.arc(l,h,i,0,2*Math.PI),r.fill(),r.beginPath(),r.arc(l,h,i,0,2*Math.PI),r.stroke(),r.strokeStyle=t.T.radarSectorColor;for(let t=0;t<6;t++){r.beginPath(),r.moveTo(l,h);const e=2*Math.PI/6*t;r.lineTo(l+Math.cos(e)*i,h+Math.sin(e)*i),r.stroke()}r.beginPath(),r.arc(l,h,i,0,2*Math.PI),r.clip(),r.strokeStyle=t.T.radarVisibilityAreaColor,r.beginPath(),r.arc(l,h,e.canvas.height/2/s,0,2*Math.PI),r.stroke(),r.scale(1/s,1/s),r.translate(-this.plane.xy[0],-this.plane.xy[1]),r.translate(o/2*s,a/2*s),r.strokeStyle=t.T.radarPlaneColor,r.lineWidth=s,r.beginPath(),r.moveTo(this.plane.xy[0],this.plane.xy[1]-3*s/n),r.lineTo(this.plane.xy[0],this.plane.xy[1]+3*s/n),r.moveTo(this.plane.xy[0]-3*s,this.plane.xy[1]),r.lineTo(this.plane.xy[0]+3*s,this.plane.xy[1]),r.stroke();for(const t of this.gameMap.all())r.save(),r.globalAlpha=.4,t.draw(r),r.restore();for(let e of this.flies)r.save(),e!==this.plane&&e instanceof v.JO?(r.strokeStyle=t.T.radarEnemyColor,r.beginPath(),r.moveTo(e.xy[0]-3*s,e.xy[1]),r.lineTo(e.xy[0]+3*s,e.xy[1]),r.moveTo(e.xy[0],e.xy[1]-3*s/n),r.lineTo(e.xy[0],e.xy[1]+3*s/n),r.stroke()):(e instanceof v.Cp||e instanceof v.Hs)&&(r.fillStyle=e instanceof v.Cp?t.T.radarMissileColor:t.T.radarPerkColor,r.beginPath(),r.ellipse(e.xy[0],e.xy[1],2*s,2*s/n,0,0,2*Math.PI),r.fill()),r.restore();r.restore(),e.globalAlpha=t.T.radarAlpha,e.drawImage(r.canvas,e.canvas.width-2*i-10,10)}pause(){this.paused||(this.paused=!0)}resume(){this.paused&&(this.lastT=null,this.paused=!1,requestAnimationFrame((t=>this.frame(t))))}launchFakeTarget(){if(this.plane.fakeTargets<=0)return;if(!this.fakeTargetTimerId)return this.fakeTargetTimerId=x.Z.set((()=>{this.plane.hideFakeTargetRadius(),this.fakeTargetTimerId=null}),2e3),void this.plane.showFakeTargetRadius(t.T.fakeTargetRadius);this.plane.fakeTargets-=1;const e=new v.jA(this.plane);this.addEntity(e)}}setTimeout((function(){const t=document.getElementById("canvas"),e=t.getContext("2d");u(t);const i=document.createElement("canvas");i.getContext("2d"),window.onresize=()=>{t.width=window.innerWidth,t.height=window.innerHeight,t.style.position="fixed",t.style.left="0",t.style.top="0",i.width=t.width,i.height=t.height},window.onresize(null),new F(e).startFromTheBeginning()}),1)})(),(t=l(165)).T["Boost/Unboost"]="Ускорение/Отменить",t.T["Center/Uncenter"]="Отцентрировать/Отменить",t.T["Chase it to death!"]="Загоняй его до смерти!",t.T["Deadly chaser!"]="Ты смертильный загонщик!",t.T["Fast/Unfast"]="Время быстрее/нормальное",t.T["Game Over"]="Конец",t.T["Hide help message"]="Спрятать помощь",t.T["Hide the message"]="Спрятать это сообщение",t.T.Keyboard="Кнопки",t.T["Launch fake targets"]="Запустить ложную цель",t.T.Pause="Пауза",t.T.Paused="Пауза",t.T["Show this help message (F1 again to hide)"]="Показать помощь (F1 чтобы спрятать)",t.T["Slowmo/Unslowmo"]="Замедлить время/нормальное",t.T["Start from the beginning"]="Начать сначала",t.T["Turn left"]="Поворот влево",t.T["Turn right"]="Поворот вправо",t.T.Unboost="Отменить ускорение",t.T.Left="Левая",t.T.Middle="Средняя",t.T.Right="Правая",t.T.ArrowRight="→",t.T.ArrowLeft="←",t.T.ArrowUp="↑",t.T.ArrowDown="↓",t.T.Space="Пробел",t.T["Initializing..."]="Инициализация...",t.T["Connecting..."]="Подключение к серверу...",t.T.enemy="враг",e=l(381),i=l(925),s=l(349),r=l(464),o=l(165),e.Z.register("retarget-missiles",[],(t=>{i.Z.periodic((function(){let i=t.flies.filter((t=>t instanceof s.JO||t instanceof s.jA));i.length>1&&t.flies.filter((t=>t instanceof s.Cp)).forEach((t=>{let o=t.target?r.Z.dist(t.xy,t.target.xy):1/0,a=i.filter((e=>e!==t.target)).filter((e=>!(e instanceof s.JO)||r.Z.dotProduct(r.Z.subtract(e.xy,t.xy),t.v)>=0)).map((e=>(e.distToM=r.Z.dist(t.xy,e.xy),e)));a.length>0&&(a.sort(((t,e)=>t.distToM<e.distToM?-1:t.distToM>e.distToM?1:0)),a[0].distToM<e&&a[0].distToM<o&&t.retarget(a[0]))}))}),300);const e=o.T.fakeTargetRadius})),(()=>{var t=l(381),e=l(658),i=l(165);t.Z.register(e.N,[],(t=>{let s=i.T.telemetryWindowSeconds*i.T.telemetrySamplesPerSecond,r=new e.N(1e3/i.T.telemetrySamplesPerSecond,t,s);return t.addTrigger(r.toTrigger()),r}))})(),(()=>{var t=l(381),e=l(811),i=l(658);t.Z.register(e.g,[i.N],((t,i)=>{let s=new e.g(i.capacity);return t.addTrigger((t=>s.step(i))),s}))})(),(()=>{var t=l(381),e=l(811),i=l(607);class s{constructor(t,e,i){this.toState=t,this.condition=e,this.run=i}transit(t,e){return!this.condition||this.condition(t,e)?(this.run&&this.run(t,e),this.toState):null}}class r{constructor(t,e){this.name=t,this.transitions=e}}class o{constructor(t,e){this.startState=t,this.sampleFilter=e,this.debug=!1}process(t,e,s){s=s||0,e.stateReached=null;let r=new i.H(t,s);for(e._state=this.startState,this.debug&&console.groupCollapsed("FSA"),this.debug&&console.log("[start]",e._state.name);!r.atEnd();){let t=r.next();if(this.sampleFilter&&!this.sampleFilter(t,e)){this.debug&&console.log("[skip sample]",t);continue}this.debug&&console.log("[sample]",t);let i=null;for(let s of e._state.transitions)if(i=s.transit(t,e),null!==i){e.stateReached=i.name,this.debug&&console.log("[transition]",e._state.name," => ",i.name,"[context]",Object.assign({},e));break}if(null===i){this.debug&&console.log("[end]",e._state,"[context]",Object.assign({},e));break}e._state=i}return this.debug&&console.log("[buffer consumed]",r.atEnd()?"'till end":"'till "+r.idx),this.debug&&console.groupEnd(),r.atEnd()?-1:r.idx}step(t,e){if(void 0===e._state&&(e._state=this.startState),this.sampleFilter&&!this.sampleFilter(t,e))return this.debug&&console.log("[skip sample]",t),!0;this.debug&&console.log("[sample]",t);let i=null;for(let s of e._state.transitions)if(i=s.transit(t,e),null!==i)return e.stateReached=i.name,this.debug&&console.log("[transition]",e._state.name," => ",i.name,"[context]",Object.assign({},e)),e._state=i,!0;return this.debug&&console.log("[end]",e._state,"[context]",Object.assign({},e)),delete e._state,!1}}class a{constructor(t=null,e=null){this.name=t,this.transitions=[],this.builders=e?e.builders:new Map,this._sampleFilter=e?e._sampleFilter:null}sampleFilter(t){if(null!==this._sampleFilter)throw new Error("sampleFilter already set");return this._sampleFilter=t,this}transition(t,e,i){return this.state(t),this.transitions.push({toStateName:t,condition:e,run:i}),this}state(t){let e=this.builders.get(t);return void 0===e&&(e=new a(t,this),this.builders.set(t,e)),e}build(t){let e=new Map;for(let t of this.builders.values())e.has(t.name)||e.set(t.name,new r(t.name,[]));for(let t of this.builders.values()){let i=e.get(t.name);if(void 0===i)throw new Error("Can't find state: "+t.name);for(let r of t.transitions){let t=e.get(r.toStateName);if(void 0===t)throw new Error("Can't find state: "+r.toStateName);i.transitions.push(new s(t,r.condition,r.run))}}let i=e.get(t);if(void 0===i)throw new Error("Can't find state: "+t);return new o(i,this._sampleFilter)}}var n=l(658),h=l(165);t.Z.register("deadly-chasing",[e.g,n.N],((t,e,i)=>{const s=(t,e)=>t.sameDir&&t.dist<100&&t.behind,r=3*h.T.telemetrySamplesPerSecond;let o=(new a).sampleFilter(((t,e)=>t.t>e.lastFsaTriggerTime)).state("start").transition("start",((t,e)=>!s(t))).transition("chasing",s,((t,e)=>e.chasingCount=1)).state("chasing").transition("chasing",s,((t,e)=>e.chasingCount++)).transition("death",((t,e)=>t.missileIsDead),((t,e)=>e.deathTime=t.t)).transition("inbetween",((t,e)=>e.chasingCount>=r),((t,e)=>e.inbetweenCount=1)).state("inbetween").transition("death",((t,e)=>e.inbetweenCount<=.5*e.chasingCount&&t.missileIsDead),((t,e)=>e.deathTime=t.t)).transition("inbetween",((t,e)=>e.inbetweenCount<=.5*e.chasingCount&&!t.missileIsDead),((t,e)=>e.inbetweenCount++)).transition("failed").build("start"),n=new class{constructor(){this.reset(),this.lastFsaTriggerTime=0}reset(){this.stateReached=null,this.chasingCount=0,this.deathTime=void 0}};e.addStep((e=>{o.step(e,n)?("failed"==n.stateReached&&n.reset(),n.chasingCount>r?t.addInfo("chasingCount",(()=>h.t`Chase it to death!`),500):t.removeInfo("chasingCount"),void 0!==n.deathTime&&(t.addInfo("deadly chaser",h.t`Deadly chaser!`,3e3),t.plane.score+=10,n.lastFsaTriggerTime=n.deathTime,n.reset())):n.reset()}))}))})()})();