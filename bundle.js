/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t,e,s,i,r,a,o={811:(t,e,s)=>{s.d(e,{g:()=>a});var i=s(607),r=s(464);class a{history;checks;steps;lastPlaneState;constructor(t,...e){this.history=new i.d(t),this.checks=e,this.steps=[]}addCheck(t){this.checks.push(t)}addStep(t){this.steps.push(t)}detect(t){t.planeState.size>0&&(t.planeState.forEach(((e,s)=>{const i=t.missileState.get(s),a=r.Z.length(r.Z.subtract(e.xy,i.xy)),o=r.Z.angle(e.v,i.v),n=Math.sign(r.Z.dotProduct(e.v,i.v))>=0,l=r.Z.behind(i.v,i.xy,e.xy),h=i.lastMissileIsDead;this.history.push({t:e.t,dist:a,angle:o,sameDir:n,behind:l,missileIsDead:h})})),this.checks.forEach((t=>t(this.history))))}step(t){if(t.planeState.size>0){const e=t.getLatestPlaneState(),s=t.getLatestMissileState();if(null===e||null===s)return;if(this.lastPlaneState===e)return;this.lastPlaneState=e;const i=r.Z.length(r.Z.subtract(e.xy,s.xy)),a=r.Z.angle(e.v,s.v),o=Math.sign(r.Z.dotProduct(e.v,s.v))>=0,n=r.Z.behind(s.v,s.xy,e.xy),l=s.lastMissileIsDead;let h={t:e.t,dist:i,angle:a,sameDir:o,behind:n,missileIsDead:l};this.steps.forEach((t=>t(h)))}}}},349:(t,e,s)=>{s.d(e,{PE:()=>D,ZJ:()=>$,OQ:()=>R,jA:()=>z,Vk:()=>F,Cp:()=>Z,JA:()=>O,Hs:()=>A,JO:()=>S,qF:()=>P,gF:()=>k,$7:()=>C,Vz:()=>M,Ux:()=>B,MB:()=>E});var i=s(925);function r(t,e,s,i,r){if(i<=s)return()=>e;const a=t.map(((t,s)=>r().init(t,e[s])));return t=>a.map((e=>e.progress((t-s)/(i-s))))}function a(t,e,s,a,o,n,l){let h=r(t,e,0,a,o),c=i.Z.now(),d=t.slice(),u=null,f=()=>{null!==u&&(i.Z.clear(u),u=null,l&&l(d))},g=()=>{let t=Math.min(i.Z.now()-c,a);d=h(t),n&&n(d),t==a&&f()};return u=i.Z.periodic(g,s),g(),Object.assign((()=>d),{cancel:f})}class o{static ease=()=>()=>new l;static linear=(t=0)=>()=>new n(t);static byName(t){switch(t){case"ease":return o.ease();case"linear":return o.linear(0);default:throw new Error("Unknown timing function: "+t)}}from;to;init(t,e){return this.from=t,this.to=e,this.doInit(),this}}class n extends o{shift;t1s;t2s;step;constructor(t){super(),this.shift=t}doInit(){this.t1s=0,this.t2s=1,this.shift<0&&(this.t1s=0+1*-this.shift),this.shift>0&&(this.t2s=0+1*(1-this.shift)),this.step=(this.to-this.from)/(this.t2s-this.t1s)}progress(t){return t<=this.t1s?this.from:t>=this.t2s?this.to:this.from+this.step*(t-this.t1s)}}class l extends o{doInit(){}progress(t){return this.from+Math.sin(Math.PI/2*t)*(this.to-this.from)}}var h=s(751),c=s(464);const d="input is invalid type",u="0123456789abcdef".split(""),f=[-2147483648,8388608,32768,128],g=[24,16,8,0],p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];class m{h0;h1;h2;h3;h4;h5;h6;h7;blocks;block=0;start=0;bytes=0;hBytes=0;finalized=!1;hashed=!1;first=!0;lastByteIndex;is224;constructor(t=!1){this.init(t)}init(t){this.is224=t,this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225)}update(t){if(this.finalized)return this;var e,s=typeof t;if("string"!==s){if("object"!==s)throw new Error(d);if(null===t)throw new Error(d);if(t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error(d);e=!0}for(var i,r,a=0,o=t.length,n=this.blocks;a<o;){if(this.hashed&&(this.hashed=!1,n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),e)for(r=this.start;a<o&&r<64;++a)n[r>>2]|=t[a]<<g[3&r++];else for(r=this.start;a<o&&r<64;++a)(i=t.charCodeAt(a))<128?n[r>>2]|=i<<g[3&r++]:i<2048?(n[r>>2]|=(192|i>>6)<<g[3&r++],n[r>>2]|=(128|63&i)<<g[3&r++]):i<55296||i>=57344?(n[r>>2]|=(224|i>>12)<<g[3&r++],n[r>>2]|=(128|i>>6&63)<<g[3&r++],n[r>>2]|=(128|63&i)<<g[3&r++]):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++a)),n[r>>2]|=(240|i>>18)<<g[3&r++],n[r>>2]|=(128|i>>12&63)<<g[3&r++],n[r>>2]|=(128|i>>6&63)<<g[3&r++],n[r>>2]|=(128|63&i)<<g[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=n[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}finalize(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=f[3&e],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}}hash(){var t,e,s,i,r,a,o,n,l,h=this.h0,c=this.h1,d=this.h2,u=this.h3,f=this.h4,g=this.h5,m=this.h6,y=this.h7,v=this.blocks;for(t=16;t<64;++t)e=((r=v[t-15])>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,s=((r=v[t-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,v[t]=v[t-16]+e+v[t-7]+s<<0;for(l=c&d,t=0;t<64;t+=4)this.first?(this.is224?(a=300032,y=(r=v[0]-1413257819)-150054599<<0,u=r+24177077<<0):(a=704751109,y=(r=v[0]-210244248)-1521486534<<0,u=r+143694565<<0),this.first=!1):(e=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),i=(a=h&c)^h&d^l,y=u+(r=y+(s=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&g^~f&m)+p[t]+v[t])<<0,u=r+(e+i)<<0),e=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),i=(o=u&h)^u&c^a,m=d+(r=m+(s=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7))+(y&f^~y&g)+p[t+1]+v[t+1])<<0,e=((d=r+(e+i)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),i=(n=d&u)^d&h^o,g=c+(r=g+(s=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&y^~m&f)+p[t+2]+v[t+2])<<0,e=((c=r+(e+i)<<0)>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),i=(l=c&d)^c&u^n,f=h+(r=f+(s=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&m^~g&y)+p[t+3]+v[t+3])<<0,h=r+(e+i)<<0;this.h0=this.h0+h<<0,this.h1=this.h1+c<<0,this.h2=this.h2+d<<0,this.h3=this.h3+u<<0,this.h4=this.h4+f<<0,this.h5=this.h5+g<<0,this.h6=this.h6+m<<0,this.h7=this.h7+y<<0}hex(){this.finalize();var t=this.h0,e=this.h1,s=this.h2,i=this.h3,r=this.h4,a=this.h5,o=this.h6,n=this.h7,l=u[t>>28&15]+u[t>>24&15]+u[t>>20&15]+u[t>>16&15]+u[t>>12&15]+u[t>>8&15]+u[t>>4&15]+u[15&t]+u[e>>28&15]+u[e>>24&15]+u[e>>20&15]+u[e>>16&15]+u[e>>12&15]+u[e>>8&15]+u[e>>4&15]+u[15&e]+u[s>>28&15]+u[s>>24&15]+u[s>>20&15]+u[s>>16&15]+u[s>>12&15]+u[s>>8&15]+u[s>>4&15]+u[15&s]+u[i>>28&15]+u[i>>24&15]+u[i>>20&15]+u[i>>16&15]+u[i>>12&15]+u[i>>8&15]+u[i>>4&15]+u[15&i]+u[r>>28&15]+u[r>>24&15]+u[r>>20&15]+u[r>>16&15]+u[r>>12&15]+u[r>>8&15]+u[r>>4&15]+u[15&r]+u[a>>28&15]+u[a>>24&15]+u[a>>20&15]+u[a>>16&15]+u[a>>12&15]+u[a>>8&15]+u[a>>4&15]+u[15&a]+u[o>>28&15]+u[o>>24&15]+u[o>>20&15]+u[o>>16&15]+u[o>>12&15]+u[o>>8&15]+u[o>>4&15]+u[15&o];return this.is224||(l+=u[n>>28&15]+u[n>>24&15]+u[n>>20&15]+u[n>>16&15]+u[n>>12&15]+u[n>>8&15]+u[n>>4&15]+u[15&n]),l}toString(){return this.hex()}digest(){this.finalize();var t=this.h0,e=this.h1,s=this.h2,i=this.h3,r=this.h4,a=this.h5,o=this.h6,n=this.h7,l=[t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24&255,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,o>>24&255,o>>16&255,o>>8&255,255&o];return this.is224||l.push(n>>24&255,n>>16&255,n>>8&255,255&n),l}array(){return this.digest()}arrayBuffer(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),t}}var y=s(485),v=s(165);class x{target;constructor(){this.target=null}}class b{static idPrefix=function(){return function(){var t=new m;if(t.update((new Date).getTime().toString()),window.crypto){var e=new Uint32Array(16);window.crypto.getRandomValues(e);for(let s of e)t.update(s.toString())}else for(var s=0;s<16;s++)t.update(Math.random().toString());return t.update(navigator.userAgent||""),t.update(navigator.language||""),t.update((window.screen.colorDepth||-1).toString()),t.update((window.devicePixelRatio||"").toString()),t.update((new Date).getTimezoneOffset().toString()),t.update(navigator.hardwareConcurrency.toString()||""),t.update(navigator.platform||""),t.update((navigator.hardwareConcurrency||"").toString()),t.hex()}()}();static idIndex=0;static __type="Entity";game=null;xy;dead;layer;id;infoItems;_subscribers;constructor(t){this.xy=c.Z.clone(t),this.dead=!1,this.layer=0,this.id=b.generateNewId(),this.infoItems=new Map,this._subscribers=[]}static generateNewId(){return b.idPrefix+"-"+b.idIndex++}setGame(t){this.game=t}getGame(){return this.game}emit(t){t.target=this,this._subscribers.forEach((e=>e(t)))}subscribe(t){this._subscribers.push(t)}__serialize(){return{xy:this.xy,dead:this.dead,id:this.id,layer:this.layer}}__unserialize(t){this.xy=t.xy,this.dead=t.dead,this.id=t.id,this.layer=t.layer,y.Z.getLink("game",(t=>this.game=t))}getRegion(){return h.yp.EMPTY}getCollideRegion(){return this.getRegion()}progress(t){}draw(t){this.drawInfo(t)}addInfo(t,e,s,r){if("function"!=typeof e){let t=e.toString();e=()=>t}this.removeInfo(t);let a=void 0!==s&&s>0?i.Z.set((()=>this.removeInfo(t)),s):null;this.infoItems.set(t,{textSupplier:e,timerId:a,color:r})}removeInfo(t){let e=this.infoItems.get(t);void 0!==e&&(null!==e.timerId&&i.Z.clear(e.timerId),this.infoItems.delete(t))}drawInfo(t){if(0==this.infoItems.size)return;t.save();const e=v.T.infoFontSize,s=e+v.T.infoFontSize/2;let i=this.xy[0]+20,r=this.xy[1];t.font=`${e}px serif`,t.textBaseline="top",t.globalAlpha=v.T.infoAlpha;for(let e of this.infoItems.values()){let a=e.textSupplier();t.fillStyle=e.color||v.T.infoColor,t.fillText(a,i,r),r+=s}t.restore()}enhanceDrawWith(t){let e=this.draw;return this.draw=s=>{e.call(this,s),t.call(this,s)},()=>this.draw=e}collideWith(t){return h.yp.intersects(this.getCollideRegion(),t.getCollideRegion())}linearSize(){const t=this.getRegion().getBoundingBox();return Math.max(t[2]-t[0],t[3]-t[1])}}y.Z.registerConstructor(b.__type,(t=>new b(t.xy)));class w extends b{m;size;static __type="Fly";v;constructor(t,e,s,i){super(t),this.m=e,this.size=i,this.v=c.Z.clone(s)}__serialize(){let t=super.__serialize();return t.m=this.m,t.v=this.v,t.size=this.size,t}__unserialize(t){super.__unserialize(t),this.m=t.m,this.v=t.v,this.size=t.size}getRegion(){return new h.kb(this.xy,this.size)}progress(t){const e=c.Z.mulByScalar(this.v,t);this.xy=c.Z.add(this.xy,e)}applyForce(t,e){const s=c.Z.mulByScalar(t,e/this.m);this.v=c.Z.add(this.v,s)}applyRotation(t,e){this.v=c.Z.rotate(this.v,t*e)}}y.Z.registerConstructor(w.__type,(t=>new w(t.xy,t.m,t.v,t.size)));class T extends w{static __type="Trail";tail;lastXy=null;progressTrail;fadingAlpha;constructor(t,e,s,i){super(t,e,s,i),this.tail=[],this.lastXy=null,this.progressTrail=!0,this.fadingAlpha=null}__serialize(){return super.__serialize()}_stopTrailing(t){this.progressTrail=!1,a([1],[0],t/10,t,o.linear(0),(t=>this.fadingAlpha=t[0]))}progress(t){super.progress(t),this.progressTrail&&(null===this.lastXy&&(this.lastXy=this.xy),c.Z.length(c.Z.subtract(this.xy,this.lastXy))>10&&(this.tail.push(this.xy),this.lastXy=this.xy,this.tail.length>20&&this.tail.splice(0,this.tail.length-20)))}draw(t){if(super.draw(t),null!==this.fadingAlpha&&(t.globalAlpha=this.fadingAlpha),0===this.tail.length)return;const e=r(v.T.trailStartColor,v.T.trailEndColor,1,this.tail.length,o.linear(0));for(let s=1;s<this.tail.length;s++){const i=e(s);t.strokeStyle=(0,v.B)(i),t.beginPath(),t.moveTo(this.tail[s-1][0],this.tail[s-1][1]),t.lineTo(this.tail[s][0],this.tail[s][1]),t.stroke()}if(this.progressTrail){const s=e(this.tail.length);t.strokeStyle=(0,v.B)(s),t.beginPath(),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(this.tail[this.tail.length-1][0],this.tail[this.tail.length-1][1]),t.stroke()}}}y.Z.registerConstructor(T.__type,(t=>new T(t.xy,t.m,t.v,t.size)));class S extends w{static __type="Plane";_lifes;_fakeTargets;_score;_booster;layer;omega;hangForce;boostForce;minVelocity;maxVelocity;void;fakeTargetRadius;constructor(t){super(t,1,[0,-.1],7),this._lifes=1,this._fakeTargets=2,this._score=0,this._booster=1e4,this.layer=100,this.omega=null,this.hangForce=null,this.boostForce=null,this.minVelocity=.01,this.maxVelocity=.1,this.void=!0,i.Z.set((()=>this.void=!1),v.T.planeBirthVoidPeriod)}set lifes(t){t<0&&(t=0);let e=t-this._lifes;this._lifes=t,this.emit(new C(e))}get lifes(){return this._lifes}set fakeTargets(t){t<0&&(t=0);let e=t-this._fakeTargets;this._fakeTargets=t,this.emit(new k(e))}get fakeTargets(){return this._fakeTargets}set score(t){t<0&&(t=0);let e=t-this._score;this._score=t,this.emit(new M(e))}get score(){return this._score}set booster(t){t<0&&(t=0);let e=t-this._booster;this._booster=t,this.emit(new P(e))}get booster(){return this._booster}getCollideRegion(){return this.void?h.yp.EMPTY:super.getCollideRegion()}__serialize(){let t=super.__serialize();return t.maxVelocity=this.maxVelocity,t.omega=this.omega,t.hangForce=this.hangForce,t.boostForce=this.boostForce,t.minVelocity=this.minVelocity,t.maxVelocity=this.maxVelocity,t.void=this.void,t.lifes=this.lifes,t.fakeTargets=this.fakeTargets,t.score=this.score,t.booster=this.booster,t}__unserialize(t){super.__unserialize(t),this.maxVelocity=t.maxVelocity,this.omega=t.omega,this.hangForce=t.hangForce,this.boostForce=t.boostForce,this.minVelocity=t.minVelocity,this.maxVelocity=t.maxVelocity,this.void=t.void,this.lifes=t.lifes,this.fakeTargets=t.fakeTargets,this.score=t.score,this.booster=t.booster}draw(t){super.draw(t);const e=c.Z.normalize(this.v),s=c.Z.subtract(this.xy,c.Z.mulByScalar(e,this.size/7*5)),i=c.Z.add(this.xy,c.Z.mulByScalar(e,this.size/7*10)),r=c.Z.subtract(this.xy,c.Z.mulByScalar(c.Z.normal(e),this.size)),a=c.Z.add(this.xy,c.Z.mulByScalar(c.Z.normal(e),this.size));if(t.lineWidth=3,this.void&&(t.globalAlpha=.2),t.strokeStyle=v.T.planeColor,t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(i[0],i[1]),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(r[0],r[1]),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(a[0],a[1]),t.stroke(),null!==this.boostForce){t.fillStyle=v.T.planeBoosterColor,t.globalAlpha=v.T.planeBoosterAlpha;for(let s=0;s<3;s++){t.beginPath();const i=c.Z.add(c.Z.subtract(this.xy,c.Z.mulByScalar(e,5+this.size/7*5*s/2)),c.Z.random(1));t.arc(i[0],i[1],2/(1+s/2),0,2*Math.PI),t.fill()}}this.fakeTargetRadius&&(t.globalAlpha=.2,t.fillStyle=v.T.planeFakeTargetRadiusColor,t.beginPath(),t.arc(this.xy[0],this.xy[1],this.fakeTargetRadius,0,2*Math.PI),t.fill())}progress(t){if(null!==this.omega&&this.applyRotation(this.omega,t),null!==this.hangForce){const e=c.Z.mulByScalar(c.Z.normalize(this.v),-this.hangForce);this.applyForce(e,t)}if(null!==this.boostForce){const e=c.Z.mulByScalar(c.Z.normalize(this.v),this.boostForce);this.applyForce(e,t)}const e=c.Z.length(this.v);e<this.minVelocity&&(this.v=c.Z.mulByScalar(c.Z.normalize(this.v),this.minVelocity)),e>this.maxVelocity&&(this.v=c.Z.mulByScalar(c.Z.normalize(this.v),this.maxVelocity)),super.progress(t)}left(){this.omega=-.004}right(){this.omega=.004}noRotate(){this.omega=null}startHang(){this.hangForce=1e-4}stopHang(){this.hangForce=null}startBoost(){this.boostForce=1e-4}stopBoost(){this.boostForce=null}showFakeTargetRadius(t){this.fakeTargetRadius=t}hideFakeTargetRadius(){this.fakeTargetRadius=null}}y.Z.registerConstructor(S.__type,(t=>new S(t.xy)));class _ extends x{amount;constructor(t){super(),this.amount=t}}class C extends _{}class k extends _{}class M extends _{}class P extends _{}class z extends w{static __type="FakeTarget";omega;color;constructor(t){if(null!==t){const e=c.Z.negate(c.Z.normalize(t.v)),s=2*Math.random()*Math.PI/10,i=s-2*s,r=c.Z.rotate(c.Z.mulByScalar(e,.1+50*Math.random()/1e3),i);super(c.Z.add(t.xy,c.Z.mulByScalar(e,2*t.size)),.1,r,3),this.layer=100,this.omega=.002-2*Math.random()*.002,this.color=v.T.fakeTargetStartColor,a(v.T.fakeTargetStartColor,v.T.fakeTargetEndColor,100,5e3,o.ease(),(t=>this.color=t)),a([c.Z.length(r)],[0],100,5e3,o.ease(),(t=>this.v=c.Z.mulByScalar(c.Z.normalize(this.v),t[0])),(()=>this.dead=!0))}}__serialize(){let t=super.__serialize();return t.omega=this.omega,t.color=this.color,t}__unserialize(t){this.omega=t.omega,this.color=t.color}progress(t){super.progress(t),this.applyRotation(this.omega,t)}draw(t){super.draw(t),t.strokeStyle=(0,v.B)(this.color),t.beginPath();for(let e=0;e<3;e++){const e=c.Z.random(this.size);t.moveTo(this.xy[0],this.xy[1]),t.lineTo(this.xy[0]+e[0],this.xy[1]+e[1]),t.moveTo(this.xy[0],this.xy[1]),t.lineTo(this.xy[0]-e[0],this.xy[1]-e[1])}t.stroke()}}y.Z.registerConstructor(z.__type,(()=>new z(null)));class Z extends T{static __type="Missile";maxSpeed;minSpeed;oldTargets;target;maxOmega;lifeTime;dieAnimation;constructor(t,e){const s=.13;super(t,.1,[0,s+Math.random()*(.15-s)],3),this.layer=100,this.maxSpeed=.15,this.minSpeed=s,this.oldTargets=[],this.target=e,this.maxOmega=.002,this.lifeTime=1e4+3e4*Math.random()}__serialize(){let t=super.__serialize();return t.maxSpeed=this.maxSpeed,t.minSpeed=this.minSpeed,t.maxOmega=this.maxOmega,t.lifeTime=this.lifeTime,t.target=this.target?this.target.id:null,t.oldTargets=this.oldTargets.map((t=>t.id)),t}__unserialize(t){super.__unserialize(t),this.maxSpeed=t.maxSpeed,this.minSpeed=t.minSpeed,this.maxOmega=t.maxOmega,this.lifeTime=t.lifeTime}isDying(){return this.dead||this.dieAnimation}getCollideRegion(){return this.dieAnimation?h.yp.EMPTY:super.getCollideRegion()}progress(t){if(this.lifeTime-=t,this.lifeTime<=0&&(this.dead=!0),!this.dieAnimation&&this.lifeTime<2e3&&(this._stopTrailing(1500),this.dieAnimation=a(v.T.missileDieStartColor,v.T.missileDieEndColor,100,2e3,o.linear(0))),void 0!==this.target&&(this.target.dead&&(this.target=this.oldTargets.pop()),void 0!==this.target)){const e=c.Z.subtract(this.target.xy,this.xy),s=c.Z.alignUp(e,this.v);this.applyRotation(this.maxOmega*(s[0]>0?1:-1),t)}super.progress(t)}retarget(t){if(this.target===t)return;let e,s=this;if(void 0!==this.target){let i=this.target.enhanceDrawWith((i=>{void 0!==s.target&&(i.fillStyle="#ff9999",i.globalAlpha=.3,i.strokeStyle="#ff9999",i.beginPath(),i.moveTo(s.xy[0],s.xy[1]),i.lineTo(s.target.xy[0],s.target.xy[1]),i.stroke(),i.beginPath(),i.arc(t.xy[0],t.xy[1],e()[0],0,2*Math.PI),i.fill())}));e=a([50],[0],100,1e3,o.ease(),void 0,i),this.oldTargets.push(this.target)}this.target=t}draw(t){super.draw(t);const e=c.Z.normalize(this.v),s=c.Z.add(this.xy,c.Z.mulByScalar(e,5*this.size/3)),i=c.Z.subtract(this.xy,c.Z.mulByScalar(c.Z.normal(e),2*this.size/3)),r=c.Z.add(this.xy,c.Z.mulByScalar(c.Z.normal(e),2*this.size/3));let a="black";if(this.dieAnimation&&(a=(0,v.B)(this.dieAnimation())),t.strokeStyle=a,t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(s[0],s[1]),t.moveTo(r[0],r[1]),t.lineTo(s[0],s[1]),t.stroke(),!this.dieAnimation){const s=1/(this.maxSpeed-this.minSpeed),i=-this.minSpeed*s,r=c.Z.length(this.v)*s+i;t.fillStyle=(0,v.B)(255*(1-r),0,255*r),t.globalAlpha=.5;for(let s=0;s<3;s++){t.beginPath();const i=c.Z.add(c.Z.subtract(this.xy,c.Z.mulByScalar(e,5*this.size/3*s/2)),c.Z.random(1));t.arc(i[0],i[1],2/(1+s/2),0,2*Math.PI),t.fill()}}}}y.Z.registerConstructor(Z.__type,(t=>{let e=new Z(t.xy,void 0);return null!==t.target?y.Z.getLink(t.target,(t=>e.target=t),(()=>{})):e.target=new b([1/0,1/0]),y.Z.getLink(t.oldTargets,(t=>e.oldTargets=t),(()=>{})),e}));class I extends x{target;constructor(t){super(),this.target=t}}class E extends b{constructor(t){super(t)}saveChanges(){const t=this.getGame();null!==t&&t.gameMap.entityChanged(this)}}class A extends E{static __type="Perk";size;constructor(t){super(t),this.layer=100,this.size=3}__serialize(){let t=super.__serialize();return t.size=this.size,t}__unserialize(t){super.__unserialize(t),this.size=t.size}getRegion(){return new h.kb(this.xy,this.size)}collected(t){this.dead=!0,this.emit(new I(this))}}y.Z.registerConstructor(A.__type,(t=>new A(t.xy)));class F extends A{static __type="Life";constructor(t){super(t)}draw(t){super.draw(t),t.strokeStyle=v.T.lifeColor,t.fillStyle=v.T.lifeColor,t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.fill()}collected(t){super.collected(t),t.lifes+=1}}y.Z.registerConstructor(F.__type,(t=>new F(t.xy)));class B extends A{static __type="Star";constructor(t){super(t)}draw(t){super.draw(t),t.strokeStyle=v.T.scoreColor,t.fillStyle=v.T.scoreColor,t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(this.xy[0],this.xy[1],this.size,0,2*Math.PI),t.fill()}collected(t){super.collected(t),t.score+=1}}y.Z.registerConstructor(B.__type,(t=>new B(t.xy)));class R extends w{static __type="Explosion";deadCount;circles;color;particles;constructor(t,e){super(t,1,[0,0],1),this.layer=100,this.deadCount=e,this.circles=[];let s=0;for(let r=0;r<e;r++){const e=10*this.size-2*Math.random()*10*this.size,r=10*this.size-2*Math.random()*10*this.size,n=[c.Z.add(t,[e,r]),0];i.Z.set((()=>{a([0],[20*this.size],10,1e3,o.ease(),(t=>{n[1]=t[0],this.deadCount--}),(()=>this.dead=this.deadCount<=0))}),s+=100*Math.random()),this.circles.push(n)}this.color=a(v.T.explosionStartColor,v.T.explosionEndColor,100,s+1e3,o.linear(0)),this.particles=[];for(let s=0;s<10*e;s++){const e=c.Z.random(.13+2*Math.random()*.13/3);this.particles.push([t,e])}}__serialize(){let t=super.__serialize();return t.deadCount=this.deadCount,t}__unserialize(t){super.__unserialize(t)}progress(t){this.particles.forEach((e=>e[0]=c.Z.add(e[0],c.Z.mulByScalar(e[1],t))))}getRegion(){return h.yp.EMPTY}draw(t){super.draw(t),t.globalAlpha=v.T.explosionAlpha,t.fillStyle=(0,v.B)(this.color()),this.circles.forEach((e=>{t.beginPath(),t.arc(e[0][0],e[0][1],e[1],0,2*Math.PI),t.fill()})),this.particles.forEach((e=>{t.beginPath(),t.arc(e[0][0],e[0][1],2,0,2*Math.PI),t.fill()}))}}y.Z.registerConstructor(R.__type,(t=>new R(t.xy,t.deadCount)));class O extends E{static __type="Obstacle";region;constructor(t){super(t.getCenter()),this.layer=100,this.region=t}getRegion(){return this.region}draw(t){super.draw(t),this.region.draw(t,v.T.obstacleFillColor,v.T.obstacleStrokeColor)}__serialize(){const t=super.__serialize();return t.region=y.Z.toPojo(this.region),t}__unserialize(t){super.__unserialize(t)}}y.Z.registerConstructor(O.__type,(t=>new O(y.Z.unserialize(t.region))));class $ extends E{static __type="Cloud";size;color;circles;alpha=1;constructor(t,e=null){if(super(t),this.layer=200,this.size=50,this.color=v.T.cloudColor,this.circles=[],null!==e){const s=4+Math.round(6*e.nextFloat());for(let i=0;i<s;i++){const s=c.Z.add(t,c.Z.random(e.nextFloat()*this.size,(()=>e.nextFloat())));this.circles.push([s[0],s[1],e.nextFloat()*this.size])}this.alpha=.1+.4*e.nextFloat()}}getCollideRegion(){return h.yp.EMPTY}getRegion(){return h.yp.EMPTY}draw(t){super.draw(t),t.fillStyle=this.color,t.globalAlpha=this.alpha,this.circles.forEach((e=>{t.beginPath(),t.arc(e[0],e[1],e[2],0,2*Math.PI),t.fill()}))}__serialize(){const t=super.__serialize();return t.xy=this.xy,t.color=this.color,t.alpha=this.alpha,t.circles=this.circles,t.size=this.size,t}__unserialize(t){super.__unserialize(t),this.alpha=t.alpha,this.color=t.color,this.circles=t.circles,this.size=t.size}}y.Z.registerConstructor($.__type,(t=>new $(t.xy,null)));class D extends b{message;color;fontSize;constructor(t,e,s,i){super(t),this.message=e,this.color=s,this.layer=300,this.fontSize=a([10],[20],100,i||1e3,o.ease(),void 0,(()=>this.dead=!0))}getRegion(){return h.yp.EMPTY}draw(t){super.draw(t),t.globalAlpha=.5,t.fillStyle=this.color,t.font=this.fontSize()[0]+"px serif",t.fillText(this.message,this.xy[0],this.xy[1])}}},381:(t,e,s)=>{s.d(e,{Z:()=>n});const i={};class r{pluginId;dependencies;plugin;pluginValue;constructor(t,e,s){this.pluginId=t,this.dependencies=e,this.plugin=s,this.pluginValue=i}}const a=new Map;let o=!1;const n={register:function(t,e,s){if(a.has(t))throw new Error("Plugin with the id already exists: "+t);a.set(t,new r(t,e,s))},init:function(t){if(o)throw new Error("Calling plugin.init() inside plugin.init()");for(let e of function(){let t,e=[],s=[];a.forEach((t=>s.push(t)));do{t=[];for(let i of s)i.dependencies.filter((t=>-1==e.findIndex((e=>e.pluginId==t)))).length>0||(e.push(i),t.push(i));t.forEach((t=>s.splice(s.indexOf(t),1)))}while(t.length>0);return s.forEach((t=>e.push(t))),e}()){o=!0;try{let s=e.dependencies.filter((t=>a.has(t))).map((t=>a.get(t))).filter((t=>t.pluginValue!==i)).map((t=>t.pluginValue));if(s.length!=e.dependencies.length){let t=e.dependencies.filter((t=>!a.has(t)||a.get(t).pluginValue===i)).map((t=>"function"==typeof t?t.name:t)).map((t=>`'${t}'`)).join(", ");console.log("[PLUGINS]","Missed dependencies",t,"for plugin","'"+("function"==typeof e.pluginId?e.pluginId.name:e.pluginId)+"'.","Not loaded");continue}e.pluginValue=e.plugin(t,...s)}finally{o=!1}}},get:function(t){if(!a.has(t))return;let e=a.get(t).pluginValue;if(e===i)throw new Error("Plugin is not yet initialized: "+t);return e}}},751:(t,e,s)=>{s.d(e,{yp:()=>a,kb:()=>o,OI:()=>l});var i=s(464),r=s(485);class a{static __type="Region";static EMPTY=new a;void=!1;poly=null;boundingBox=null;static intersects(t,e){if(t===a.EMPTY||e==a.EMPTY)return!1;if(t.void||e.void)return!1;if(t instanceof o&&e instanceof o)return i.Z.length(i.Z.subtract(t.xy,e.xy))<t.r+e.r;const s=t.getBoundingBox(),r=e.getBoundingBox();if(s[0]>r[2]||r[0]>r[2])return!1;if(s[1]>r[3]||r[1]>r[3])return!1;const n=t.toPolygonRegion(),l=e.toPolygonRegion();for(const t of n.vertices)if(l.containsPoint(t))return!0;for(const t of l.vertices)if(n.containsPoint(t))return!0;return!1}toPolygonRegion(){return null===this.poly&&(this.poly=this.__toPolygonRegion()),this.poly}getBoundingBox(){if(null===this.boundingBox){const t=this.toPolygonRegion();if(0==t.vertices.length)return[0,0,0,0];let e=1e20,s=-1e20,i=1e20,r=-1e20;for(let a of t.vertices)a[0]<e&&(e=a[0]),a[0]>s&&(s=a[0]),a[1]<i&&(i=a[1]),a[1]>r&&(r=a[1]);this.boundingBox=[e,i,s,r]}return this.boundingBox}getCenter(){const t=this.getBoundingBox();return[(t[0]+t[2])/2,(t[1]+t[3])/2]}__toPolygonRegion(){return l.EMPTY}draw(t,e,s){t.fillStyle=e,t.strokeStyle=this.void?e:s;const i=this.toPolygonRegion();if(0!=i.vertices.length){t.beginPath(),t.moveTo(i.vertices[0][0],i.vertices[0][1]);for(let e=1;e<=i.vertices.length;e++){const s=e%i.vertices.length;t.lineTo(i.vertices[s][0],i.vertices[s][1])}t.fill(),t.beginPath(),t.moveTo(i.vertices[0][0],i.vertices[0][1]);for(let e=1;e<=i.vertices.length;e++){const s=e%i.vertices.length;t.lineTo(i.vertices[s][0],i.vertices[s][1])}t.stroke()}}__serialize(){return{void:this.void}}__unserialize(t){this.void=t.void}resetCache(){this.boundingBox=null,this.poly=null}moveTo(t){this.resetCache()}scale(t){this.resetCache()}rotate(t){this.resetCache()}}r.Z.registerConstructor(a.__type,(t=>new a));class o extends a{static __type="CircleRegion";xy;r;constructor(t,e){super(),this.xy=t,this.r=e}__toPolygonRegion(){const t=[],e=Math.max(5,Math.min(30,Math.round(2*Math.PI*this.r/5)));for(let s=0;s<e;s++){const i=this.xy[0]+this.r*Math.cos(2*Math.PI/e*s),r=this.xy[1]+this.r*Math.sin(2*Math.PI/e*s);t.push([i,r])}return new l(t)}scale(t){this.r*=t,super.scale(t)}moveTo(t){this.xy=t,super.moveTo(t)}rotate(t){}__serialize(){const t=super.__serialize();return t.xy=this.xy,t.r=this.r,t}__unserialize(t){super.__unserialize(t)}}r.Z.registerConstructor(o.__type,(t=>new o(t.xy,t.r)));class n{v0;v;static __type="Semispace";direction;constructor(t,e,s){this.v0=t,this.v=e,this.direction=this._direction(s)}containsPoint(t){return this.direction*this._direction(t)>=0}_direction(t){if(Math.abs(this.v[0])<1e-6)return Math.sign(t[0]-this.v0[0]);const e=this.v0[1]+(t[0]-this.v0[0])/this.v[0]*this.v[1];return Math.sign(t[1]-e)}__serialize(){return{v0:this.v0,v:this.v,direction:this.direction}}__unserialize(t){this.direction=t.direction}}r.Z.registerConstructor(n.__type,(t=>new n(t.v0,t.v,[0,0])));class l extends a{static __type="ConvexPolygonRegion";static EMPTY=new l([]);vertices;semispaces;constructor(t){super(),this.vertices=t,this.calculateSemispaces()}calculateSemispaces(){const t=this.vertices;this.semispaces=[];for(let e=0;e<t.length;e++){const s=t[e],r=i.Z.subtract(t[(e+1)%t.length],t[e]),a=t[(e+2)%t.length];this.semispaces.push(new n(s,r,a))}}scale(t){const e=this.getCenter();this.vertices=this.vertices.map((s=>i.Z.add(i.Z.mulByScalar(i.Z.subtract(s,e),t),e))),this.calculateSemispaces(),super.scale(t)}moveTo(t){const e=i.Z.subtract(t,this.getCenter());this.vertices=this.vertices.map((t=>i.Z.add(t,e))),this.calculateSemispaces(),super.moveTo(t)}rotate(t){const e=this.getCenter(),s=t/360*Math.PI;this.vertices=this.vertices.map((t=>i.Z.add(i.Z.rotate(i.Z.subtract(t,e),s),e))),this.calculateSemispaces(),super.rotate(t)}containsPoint(t){for(let e of this.semispaces)if(!e.containsPoint(t))return!1;return!0}__toPolygonRegion(){return this}__serialize(){const t=super.__serialize();return t.vertices=this.vertices,t}__unserialize(t){super.__unserialize(t)}}r.Z.registerConstructor(l.__type,(t=>new l(t.vertices)))},607:(t,e,s)=>{s.d(e,{d:()=>i,H:()=>r});class i{buffer;startIdx=0;endIdx=0;size=0;constructor(t){this.buffer=new Array(t)}get(t){if(t>=this.size)throw new Error("Index out of bound: "+t);return this.buffer[(this.startIdx+t)%this.buffer.length]}set(t,e){this.buffer[(this.startIdx+t)%this.buffer.length]=e}push(...t){for(let e of t){const t=this.buffer.length;this.size<t?(this.buffer[this.endIdx++]=e,this.size++):(this.buffer[this.startIdx]=e,this.startIdx=(this.startIdx+1)%t)}}forEach(t){for(let e=0;e<this.size;e++)t(this.get(e),e)}toArray(){const t=new Array(this.size);return this.forEach(((e,s)=>t[s]=e)),t}}class r{buffer;idx;constructor(t,e=0){this.buffer=t,this.idx=e}atEnd(){return this.idx==this.buffer.size}next(){if(this.atEnd())throw new Error("Consumption after the end");return this.buffer.get(this.idx++)}}},485:(t,e,s)=>{s.d(e,{Z:()=>l});const i=new Map;function r(t){if(null===t)return null;if(t instanceof Array)return t.map((t=>r(t)));switch(typeof t){case"boolean":case"number":case"string":return t}const e=Object.getPrototypeOf(t);if("function"==typeof t.__serialize&&e.constructor.__type)return{type:e.constructor.__type,data:t.__serialize()};{const e={};for(const s in t)e[s]=r(t[s]);return e}}let a=0;let o=[];function n(t,e){for(let s of e){let e=s.get(t);if(void 0!==e)return e}}const l={toPojo:r,serialize:function(t){return JSON.stringify(r(t))},registerConstructor:function(t,e){if(i.has(t))throw new Error("The constructor already exist: "+t);i.set(t,e)},unserialize:function t(e){try{a++;let s="string"==typeof e?JSON.parse(e):e;return s instanceof Array?s.map((e=>t(e))):function(e){if(null===e)return null;switch(typeof e){case"boolean":case"number":case"string":return e}if(e.type){let t=i.get(e.type);if(void 0===t)throw new Error("No constructor registered for type: "+e.type);let s=t(e.data);return s.__unserialize(e.data),s}{const s={};for(const i in e)s[i]=t(e[i]);return s}}(s)}finally{a--}},unserializeExisting:function(t,e){if(!e.type)throw new Error("Can't unserialize "+e);t.__unserialize(e.data)},getLink:function(t,e,s){if(s=s||(()=>{}),0==a)throw new Error("getLink can only be called inside __unserialize method");o.push({id:t,consumer:e,defaultProducer:s})},resetLinks:function(){o=[]},resolveLinks:function(...t){if(0!=a)throw new Error("resolveLinks can only be called outside __unserialize mathod");o.forEach((e=>{let s;if(e.id instanceof Array)s=e.id.map((s=>{let i=n(s,t);if(void 0===i){if(!e.defaultProducer)throw new Error("Unresolved link: "+e.id);i=e.defaultProducer()}}));else if(s=n(e.id,t),void 0===s){if(!e.defaultProducer)throw new Error("Unresolved link: "+e.id);s=e.defaultProducer()}e.consumer(s)}))}}},165:(t,e,s)=>{function i(t,...e){return t instanceof Array?(t=t.join("{}"),(r[t]||t).split("{}").map(((t,s,i)=>t+(i.length-1==s?"":e[s]))).join("")):r[t]||t}s.d(e,{t:()=>i,T:()=>r,B:()=>a});const r={booster:"🚀",boosterColor:"black",score:"★",scoreColor:"green",time:"🕐",timeColor:"black",fakeTarget:"☔",fakeTargetColor:"black",fakeTargetStartColor:[255,0,0],fakeTargetEndColor:[255,200,200],fakeTargetRadius:200,life:"❤",lifeColor:"#ff471a",planeColor:"black",planeBoosterColor:"#ff3333",planeBoosterAlpha:.5,planeStartPos:[0,0],planeFakeTargetRadiusColor:"#cccccc",planeBirthVoidPeriod:4e3,trailStartColor:[255,255,255],trailEndColor:[200,200,200],missileDieStartColor:[0,0,0],missileDieEndColor:[255,255,255],explosionStartColor:[255,0,0],explosionEndColor:[255,200,200],explosionAlpha:.5,obstacleFillColor:"#cccccc",obstacleStrokeColor:"#333333",skyColor:"#f0ffff",skyOutOfRangeColor:"#fff0f0",cloudColor:"#eeeeee",radarFillColor:"#fff2e6",radarStrokeColor:"#663300",radarSectorColor:"#ffcc99",radarVisibilityAreaColor:"#999999",radarPlaneColor:"#663300",radarMissileColor:"#ff0000",radarPerkColor:"#000000",radarEnemyColor:"#0000ff",radarAlpha:.9,radarSize:100,radarScale:20,infoFontSize:15,infoBgColor:"#ffff88",infoColor:"#000000",infoAlpha:.8,telemetrySamplesPerSecond:5,telemetryWindowSeconds:10,detectorIntervalMs:300};function a(t,e,s){if(void 0===e&&void 0===s){const e=t;return`rgb(${e[0]}, ${e[1]}, ${e[2]})`}return`rgb(${t}, ${e}, ${s})`}},658:(t,e,s)=>{s.d(e,{N:()=>o});var i=s(607),r=s(349),a=s(464);class o{interval;game;capacity;lastTime=0;time=0;planeState;missileState;lastClosestMissile=null;constructor(t,e,s){this.interval=t,this.game=e,this.capacity=s,this.planeState=new i.d(this.capacity),this.missileState=new i.d(this.capacity)}toTrigger(){return t=>this.progress(t)}progress(t){this.time+=t,this.time-this.lastTime>=this.interval&&(this.lastTime=this.time,this._collect())}_collect(){let t=1e20,e=null;const s=this.game.plane;for(let i of this.game.flies)if(i instanceof r.Cp){const r=s.xy[0]-i.xy[0],a=s.xy[1]-i.xy[1],o=r*r+a*a;o<t&&(t=o,e=i)}let i=!1;this.lastClosestMissile!==e&&(null!==this.lastClosestMissile&&this.lastClosestMissile.isDying()&&(i=!0),this.lastClosestMissile=e),this.planeState.push({t:this.time,xy:s.xy,v:a.Z.normalize(s.v)}),null!==e?this.missileState.push({t:this.time,xy:e.xy,v:a.Z.normalize(e.v),lastMissileIsDead:i}):this.missileState.push({t:this.time,xy:[1/0,1/0],v:[0,0],lastMissileIsDead:i})}getLatestPlaneState(){return this.planeState.size>0?this.planeState.get(this.planeState.size-1):null}getLatestMissileState(){return this.missileState.size>0?this.missileState.get(this.missileState.size-1):null}}},925:(t,e,s)=>{s.d(e,{Z:()=>p});let i=0;const r=[],a=new Map;let o=!1,n=0,l=!1;function h(t,e,s){return void 0===s&&(i++,s=i),c({id:s,time:n+e,duration:e,f:t,paused:!1,progressBeforePause:0}),s}function c(t){let e;for(e=0;e<r.length&&!(r[e].time>t.time);e++);a.set(t.id,t),r.splice(e,0,t)}function d(t){const e=a.get(t);return void 0===e?0:e.paused?e.progressBeforePause:0===e.duration?0:1-(e.time-n)/e.duration}function u(t){let e=a.get(t);if(void 0===e)return;if(e.paused)return;e.progressBeforePause=d(t),e.paused=!0;let s=r.findIndex((e=>e.id===t));r.splice(s,1)}function f(t){let e=a.get(t);void 0!==e&&e.paused&&(e.time=n+(1-e.progressBeforePause)*e.duration,e.paused=!1,e.progressBeforePause=0,c(e))}function g(t){return function(){if(!l)return t.apply(null,arguments);setTimeout((()=>t.apply(null,arguments)),0)}}const p={set:h,periodic:function t(e,s,i){let r=h((()=>{e(),t(e,s,r)}),s,i);return r},clear:g((function(t){let e=r.findIndex((e=>e.id===t));-1!==e&&(r.splice(e,1),a.delete(t))})),clearAll:g((function(){a.clear(),r.splice(0,r.length),o=!1})),pause:g(u),pauseAll:g((function(){for(let[t,e]of a)u(t);o=!0})),resume:g(f),resumeAll:g((function(){for(let[t,e]of a)f(t);o=!1})),allPaused:()=>o,getProgress:d,progress:function(t){if(n+=t,!o){l=!0;try{!function(){if(o)return;let t;for(t=0;t<r.length&&!(r[t].time>n);t++);t>0&&r.splice(0,t).forEach((t=>t.f()))}()}finally{l=!1}}},now:()=>n}},464:(t,e,s)=>{s.d(e,{Z:()=>r});const i={add:(t,e)=>t.map(((t,s)=>t+e[s])),negate:t=>t.map((t=>-t)),subtract:(t,e)=>i.add(t,i.negate(e)),length:t=>Math.sqrt(t.map((t=>t*t)).reduce(((t,e)=>t+e),0)),normalize:t=>i.mulByScalar(t,1/i.length(t)),mulByScalar:(t,e)=>t.map((t=>t*e)),dotProduct:(t,e)=>t.map(((t,s)=>t*e[s])).reduce(((t,e)=>t+e),0),clone:t=>t.slice(0),random:(t,e=(()=>Math.random()))=>{let s=void 0===t?1:t,i=e()*Math.PI*2;return[s*Math.sin(i),s*Math.cos(i)]},normal:t=>{let e=i.length(t),s=i.normalize(t);return[e*-s[1],e*s[0]]},rotate:(t,e)=>[t[0]*Math.cos(e)-t[1]*Math.sin(e),t[1]*Math.cos(e)+t[0]*Math.sin(e)],alignUp:(t,e)=>{const s=i.length(t),r=t[0]/s,a=t[1]/s;return[e[0]*a-e[1]*r,e[1]*a+e[0]*r]},angle:(t,e)=>{const s=i.dotProduct(t,e)/i.length(t)/i.length(e);return 180*Math.acos(s)/Math.PI},dist:(t,e)=>i.length(i.subtract(t,e)),behind:(t,e,s)=>{const r=i.normal(t);if(Math.abs(r[0])<1e-6)return s[1]<Math.sign(r[1])*e[1];const a=s[0],o=r[1]*(a-e[0])/r[0]+e[1],n=t[0]+e[0],l=r[1]*(n-e[0])/r[0]+e[1];return Math.sign(o-s[1])!=Math.sign(l-e[1])}},r=i}},n={};function l(t){var e=n[t];if(void 0!==e)return e.exports;var s=n[t]={exports:{}};return o[t](s,s.exports,l),s.exports}l.d=(t,e)=>{for(var s in e)l.o(e,s)&&!l.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t=l(165);class e{keyUp=new Map;keyDown=new Map;mouseUp=new Map;mouseDown=new Map;mouseLeave=new Map;mouseMoveAction=new Map;mouseZoomAction=new Map;doubleclickAction=new Map;_next=null;clone(){const t=new e;return t.keyUp=new Map(this.keyUp),t.keyDown=new Map(this.keyDown),t.mouseUp=new Map(this.mouseUp),t.mouseDown=new Map(this.mouseDown),t.mouseLeave=new Map(this.mouseLeave),t.mouseMoveAction=new Map(this.mouseMoveAction),t.mouseZoomAction=new Map(this.mouseZoomAction),t.doubleclickAction=new Map(this.doubleclickAction),null!=this._next&&(t._next=this._next.clone()),t}}let s=new Set,i=null,r=new e;function a(t,e){let s=r;do{let i=t(s);if(i.has(e))return i.get(e);s=s._next}while(null!==s);return null}function o(t,e){return(void 0===t[e]?"":t[e]).toString()+","+t.altKey.toString()+","+t.ctrlKey.toString()+","+t.metaKey.toString()+","+t.shiftKey.toString()}const n=[t.t`Left`,t.t`Middle`,t.t`Right`];function h(e){let s=e.split(","),i=parseInt(s[0]);return("true"==s[1]?"Alt + ":"")+("true"==s[2]?"Ctrl + ":"")+("true"==s[3]?"Win + ":"")+("true"==s[4]?"Shift + ":"")+(n[i]?n[i]:(0,t.t)(s[0]).replace(/^Key/,""))}let c=!1;window.onkeydown=t=>{if(c)return;if(s.has(t.code))return;s.add(t.code);let e=a((t=>t.keyDown),o(t,"code"));e&&(t.preventDefault(),e.callback(t))},window.onkeyup=t=>{if(c)return;s.delete(t.code);let e=a((t=>t.keyUp),o(t,"code"));e&&(t.preventDefault(),e.callback(t))};const d=function(t,e,s,i,a){const n=o({code:t.toString(),altKey:-1!==e.indexOf("Alt"),ctrlKey:-1!==e.indexOf("Ctrl"),metaKey:-1!==e.indexOf("Win")||-1!==e.indexOf("Meta"),shiftKey:-1!==e.indexOf("Shift")},"code");i&&r.keyDown.set(n,{description:s,callback:i}),a&&r.keyUp.set(n,{description:s,callback:a})},u=function(){const t=t=>{let e=[];for(let[s,i]of function*(t){let e=new Set;for(let s=r;null!=s;s=s._next){let i=t(s);for(let[t,s]of i)e.has(t)||(e.add(t),yield[t,s])}}(t))e.push({description:i.description,button:s});return e};return{keys:t((t=>t.keyDown)).map((({button:t,description:e})=>h(t)+": "+e)),mouse:t((t=>t.mouseUp)).map((({button:t,description:e})=>h(t)+": "+e)).concat(t((t=>t.mouseZoomAction)).map((({button:t,description:e})=>h(t)+"Wheel: "+e)))}},f=function(t){i=t,i.onmousedown=t=>{if(c)return;t.preventDefault();let e=a((t=>t.mouseDown),o(t,"button"));e&&e.callback(t)},i.onmousemove=t=>{if(c)return;t.preventDefault();let e=a((t=>t.mouseMoveAction),o(t,""));e&&e.callback(t)},i.onmouseup=t=>{if(c)return;t.preventDefault();let e=a((t=>t.mouseUp),o(t,"button"));e&&e.callback(t)},i.ondblclick=t=>{if(c)return;t.preventDefault();let e=a((t=>t.doubleclickAction),o(t,""));e&&e.callback(t)},window.oncontextmenu=t=>{c||t.preventDefault()},i.addEventListener("wheel",(t=>{if(c)return;t.preventDefault();let e=a((t=>t.mouseZoomAction),o(t,""));e&&e.callback(t)}),!1),i.addEventListener("mouseleave",(t=>{if(c)return;t.preventDefault();let e=a((t=>t.mouseLeave),"");e&&e.callback(t)}))},g=()=>{let t=new e;t._next=r,r=t},p=()=>r.clone(),m=t=>{r=t},y=()=>{r=new e};var v=l(381),x=l(925),b=l(349),w=l(464);class T{level=1;missileMaxCount=1;missileProbability=.5;missilePeriod=1e3;outOfRangeRadius=6e3;game;init(t){this.game=t,this.tryToCreate(b.Cp,(()=>this.missileProbability),(()=>this.missileMaxCount),(()=>{const e=t.gameMap.visibleSize,s=1.2*t.gameMap.visibleSize,i=w.Z.add(t.plane.xy,w.Z.random(e+Math.random()*(s-e)));return new b.Cp(i,t.plane)}),(()=>this.missilePeriod)),S(this.game,10,(()=>this.game.plane.lifes+=1)),S(this.game,5,(()=>this.game.plane.fakeTargets+=1)),S(this.game,2,(()=>this.game.plane.booster+=2e3))}progress(t){switch(this.level){case 1:(this.game.plane.score>4||this.game.globalTime>3e4)&&(this.level=2,this.missileMaxCount=2);break;case 2:this.game.globalTime>6e4&&(this.level=3,this.missileMaxCount=3,this.missileProbability=1)}}onDeadMissile(e){this.game.plane.score+=1,this.game.achievement(t.t`+1`,t.T.scoreColor,2e3,e)}tryToCreate(t,e,s,i,r,a){if(a&&(this.game.localMode||this.game.masterGameNode)&&Math.random()<e()&&this.game.flies.filter((e=>e instanceof t)).length<s()){let t,e;do{t=i(),e=!1;for(const s of this.game.flies)s.collideWith(t)&&(e=!0);if(!e)for(const s of this.game.gameMap.find(t.xy,t.linearSize()))s.collideWith(t)&&(e=!0)}while(e);this.game.addEntity(t)}x.Z.set((()=>this.tryToCreate(t,e,s,i,r,!0)),r())}}function S(t,e,s){let i=t.plane.score;t.plane.subscribe((r=>{r instanceof b.Vz&&t.plane.score-i>=e&&(i=t.plane.score,s())}))}function _(e,s){let i;s&&(i=p(),y(),d("Space",[],t.t`Hide the message`,(()=>o())),d("Escape",[],t.t`Hide the message`,(()=>o())),d("Enter",[],t.t`Hide the message`,(()=>o())));let r=document.getElementById("message");r.innerHTML="";let a=document.createElement("div");function o(){r.style.display="none",void 0!==i&&m(i),s&&s()}return a.innerText=e,r.appendChild(a),r.style.display="block",a.onclick=()=>o(),o}class C{r;map=new Map;constructor(t){this.r=t}insert(t,e,s){let i=Math.floor((t[0]-e)/this.r),r=Math.floor((t[0]+e)/this.r),a=Math.floor((t[1]-e)/this.r),o=Math.floor((t[1]+e)/this.r);for(let t=i,e=i*this.r;t<=r;t++,e+=this.r)for(let e=a,i=a*this.r;e<=o;e++,i+=this.r){let i=this.map.get(t);i||(i=new Map,this.map.set(t,i));let r=i.get(e);r||(r=new Set,i.set(e,r)),r.add(s)}}find(t,e){let s=Math.floor((t[0]-e)/this.r),i=Math.floor((t[0]+e)/this.r),r=Math.floor((t[1]-e)/this.r),a=Math.floor((t[1]+e)/this.r),o=new Set;for(let t=s;t<=i;t++)for(let e=r;e<=a;e++){let s=this.map.get(t);if(!s)continue;let i=s.get(e);i&&i.forEach((t=>o.add(t)))}return o}remove(t,e,s){let i=Math.floor((t[0]-e)/this.r),r=Math.floor((t[0]+e)/this.r),a=Math.floor((t[1]-e)/this.r),o=Math.floor((t[1]+e)/this.r);for(let t=i;t<=r;t++)for(let e=a;e<=o;e++){let i=this.map.get(t);if(!i)return;let r=i.get(e);if(!r)return;r.delete(s)}}clear(){this.map.clear()}}var k=l(751);const M=256,P=Math.pow(M,6),z=Math.pow(2,52),Z=2*z,I=255;class E{i=0;j=0;S=[];constructor(t){let e,s=t.length,i=0,r=0;for(s||(t=[s++]);i<M;)this.S[i]=i++;for(i=0;i<M;i++)e=this.S[i],r=I&r+t[i%s]+e,this.S[i]=this.S[r],this.S[r]=e;this.g(M)}g(t){let e,s=0,i=this.i,r=this.j,a=this.S;for(;t--;)i=I&i+1,r=I&r+a[i],e=a[i],a[i]=a[r],a[r]=e,s=s*M+a[I&a[i]+a[r]];return this.i=i,this.j=r,s}}class A{pool=[];arc4;constructor(t){const e=[];this.mixkey(this.flatten(null==t?this.autoseed():t,3),e),this.arc4=new E(e),this.mixkey(this.tostring(this.arc4.S),this.pool)}nextFloat(){let t=this.arc4.g(6),e=P,s=0;for(;t<z;)t=(t+s)*M,e*=M,s=this.arc4.g(1);for(;t>=Z;)t/=2,e/=2,s>>>=1;return(t+s)/e}flatten(t,e){const s=[];if(e&&"object"==typeof t)for(const i in t)try{s.push(this.flatten(t[i],e-1))}catch(t){}return s.length?s:"string"==typeof t?t:t+"\0"}mixkey(t,e){let s=t+"",i=0,r=0;for(;r<s.length;)e[I&r]=I&(i^=19*e[I&r])+s.charCodeAt(r++);return this.tostring(e)}autoseed(t){return window.crypto.getRandomValues(t=new Uint8Array(M)),this.tostring(t)}tostring(t){return String.fromCharCode.apply(0,t)}}var F=l(485);class B{loading=new Map;newTask(t,e){const s=this.loading.get(t);if(void 0!==s){const i=s.then((()=>e()));return this.loading.set(t,i),i}const i=e().then((e=>(this.loading.delete(t),e)));return this.loading.set(t,i),i}}class R{clear(t){return Object.keys(localStorage).filter((t=>t.startsWith("parts["))).forEach((t=>localStorage.removeItem(t))),Promise.resolve()}load(t,e){return Promise.resolve(localStorage.getItem(R.key(t,e)))}save(t,e,s){return localStorage.setItem(R.key(t,e),s),Promise.resolve()}static key(t,e){return`parts[${t},${e}]`}}class O{firebase;constructor(t){this.firebase=t}clear(t){throw new Error("Unsupported operation")}load(t,e){return this.firebase.loadString(`/maps/${t}/${e}`)}save(t,e,s){return this.firebase.saveString(`/maps/${t}/${e}`,s)}}class ${source;cache;writeBoth=!1;constructor(t,e){this.source=t,this.cache=e}clear(t){return this.cache.clear(t)}load(t,e){return this.cache.load(t,e).then((s=>null===s?this.source.load(t,e).then((s=>null===s?null:this.cache.save(t,e,s).then((()=>s)))):s))}save(t,e,s){return this.writeBoth?Promise.all([this.cache.save(t,e,s),this.source.save(t,e,s)]):this.cache.save(t,e,s)}}class D{backend;seqTasks=new B;constructor(t=new R){this.backend=t}load(t,e,s,i){if(Number.isNaN(e)||Number.isNaN(s))throw new Error("Can't load the part: "+e+", "+s);return this.seqTasks.newTask(`${t},${e},${s}`,(()=>this.backend.load(t,`${e},${s}`).then((t=>{if(null===t||"null"===t)return null;F.Z.resetLinks();const r=F.Z.unserialize(t);return F.Z.resolveLinks(new Map([["game",i]])),console.log("loaded",e,s),r}))))}save(t,e,s,i){if(Number.isNaN(e)||Number.isNaN(s))throw new Error("Can't save the part: "+e+", "+s);return this.seqTasks.newTask(`${t},${e},${s}`,(()=>this.backend.save(t,`${e},${s}`,F.Z.serialize(i)).then((t=>console.log("saved",e,s)))))}clear(t){return this.backend.clear(t)}}class U{game;_visibleSize;gameSeed;parts=new Map;byId=new Map;tree;lastPx;lastPy;partsStore;seqTasks=new B;constructor(t,e,s,i,r=new R){this.game=t,this._visibleSize=s,this.gameSeed=i,this.tree=new C(e),this.partsStore=new D(r)}get visibleSize(){return this._visibleSize}find(t,e){return this.tree.find(t,e)}findById(t){return this.byId.get(t)}reset(){this.parts.clear(),this.tree.clear(),this.byId.clear()}isPartAvailableForXy(t){const[e,s]=this.toPartCoordinates(t),i=this.parts.get(e);return void 0!==i&&void 0!==i.get(s)}deleteAllCustomContent(){this.reset(),this.partsStore.clear(this.gameSeed)}partTask(t,e){return this.seqTasks.newTask(`${t.px},${t.py}`,(()=>e(t)))}async iAmHere(t){const[e,s]=this.toPartCoordinates(t);if(this.lastPx==e&&this.lastPy==s)return;const i=this.lastPx,r=this.lastPy;this.lastPx=e,this.lastPy=s;let a=!1;Math.max(Math.abs(i-e),Math.abs(r-s))>2&&(console.log("teleportation detected",e,s),await this.saveChanged(),this.reset(),a=!0);const o=await this.loadNeighborhood(e,s);a||await this.unloadNonNeighbors(i,r,o)}unloadNonNeighbors(t,e,s){const i=[];for(let r of[-1,0,1])for(let a of[-1,0,1]){const o=t+r,n=e+a;if(s.has(`${o},${n}`))continue;const l=this.parts.get(o);if(void 0===l)continue;const h=l.get(n);if(!h)continue;const c=()=>{this.removePart(h),console.log("unloaded",h.px,h.py)};h.random?c():i.push(this.savePart(h).then((()=>c())))}return Promise.all(i).then()}loadNeighborhood(t,e){const s=new Set,i=[];for(let r of[0,-1,1])for(let a of[0,-1,1]){const o=t+r,n=e+a;s.add(`${o},${n}`);let[l,h]=this.getOrCreatePart(o,n);if("new"===h){const t=this.loadPart(l);i.push(t)}}return Promise.all(i).then((()=>s))}withTemporaryEntity(t,e){const s=this.getPartByXy(t.xy);null!==s&&(this.add(s,t),e(),this.remove(s,t,!0))}addEntity(t){const e=this.getPartByXy(t.xy);null!==e&&(this.add(e,t),e.random=!1)}entityChanged(t){const e=this.getPartByXy(t.xy);null!==e&&(e.random=!1)}changeEntityGeometry(t,e){this.removeEntity(t),e(t),this.addEntity(t)}changeEntityGeometryAndSave(t,e){this.changeEntityGeometry(t,e),this.saveChanged()}addEntityAndSave(t){this.addEntity(t),this.saveChanged()}removeEntity(t){const e=this.getPartByXy(t.xy);null!==e&&this.remove(e,t,!0)}removeEntityAndSave(t){this.removeEntity(t),this.saveChanged()}saveChanged(){const t=[];for(const e of this.parts.values())for(const s of e.values())s.random||t.push(this.savePart(s));return Promise.all(t)}toPartCoordinates(t){return[Math.floor(t[0]/this._visibleSize),Math.floor(t[1]/this._visibleSize)]}*all(){for(const t of this.parts.values())for(const e of t.values())for(let t of e.entities)yield t}drawParts(t){t.strokeStyle="#cccccc";for(const[e,s]of this.parts)for(const i of s.keys())t.strokeRect(e*this._visibleSize,i*this._visibleSize,this._visibleSize,this._visibleSize)}savePart(t){return this.partTask(t,(t=>this.partsStore.save(this.gameSeed,t.px,t.py,t.entities)))}loadPart(t){return this.partTask(t,(t=>this.partsStore.load(this.gameSeed,t.px,t.py,this.game).then((e=>{if(e){for(let s of e)this.add(t,s);t.random=!1}else this.generate(t)}))))}randomXy(t,e,s){return[(t+s.nextFloat())*this._visibleSize,(e+s.nextFloat())*this._visibleSize]}generate(t){const e=new A(`${t.px},${t.py},${this.gameSeed}`);return this.tryToCreate(t,this._visibleSize/2e3,(()=>new b.Ux(this.randomXy(t.px,t.py,e))),e),this.tryToCreate(t,this._visibleSize/4e3,(()=>new b.Vk(this.randomXy(t.px,t.py,e))),e),this.randomObstacles(t,4*this._visibleSize/1e3,e),this.randomClouds(t,10*this._visibleSize/500,e),console.log("generated",t.px,t.py),t.random=!0,t}tryToCreate(t,e,s,i){const r=Math.floor(i.nextFloat()*(e+1));for(let e=0;e<r;e++){let e,i;do{e=s(),i=!1;for(const t of this.tree.find(e.xy,e.linearSize()))t.collideWith(e)&&(i=!0)}while(i);this.add(t,e)}}randomObstacles(t,e,s){const i=Math.floor(s.nextFloat()*(e+1));for(let e=0;e<i;e++){let e,i=!1;do{let r=this.randomXy(t.px,t.py,s),a=20+30*s.nextFloat();const o=Math.round(3+10*s.nextFloat()),n=[];for(let t=0;t<o;t++){const e=a*Math.cos(2*Math.PI/o*t),s=a*Math.sin(2*Math.PI/o*t);n.push([r[0]+e,r[1]+s])}e=new b.JA(new k.OI(n)),i=!1;for(let t of this.tree.find(r,a))t.collideWith(e)&&(i=!0)}while(i);this.add(t,e)}}randomClouds(t,e,s){const i=Math.floor(s.nextFloat()*(e+1));for(let e=0;e<i;e++)this.add(t,new b.ZJ(this.randomXy(t.px,t.py,s),s))}removePart(t){t.entities.forEach((e=>this.remove(t,e,!1))),t.entities=[];const e=this.parts.get(t.px);void 0!==e&&(e.delete(t.py),0==e.size&&this.parts.delete(t.px))}remove(t,e,s){if(s){const s=t.entities.indexOf(e);if(s<0)throw new Error("Can't remove non-existing entity");t.entities.splice(s,1)}t.random=!1,e.setGame(null),this.tree.remove(e.xy,e.linearSize(),e),this.byId.delete(e.id)}getPartByXy(t){const e=Math.floor(t[0]/this._visibleSize),s=Math.floor(t[1]/this._visibleSize),i=this.getPart(e,s,!1);return null===i?null:i[0]}getOrCreatePart(t,e){const s=this.getPart(t,e,!0);if(null===s)throw new Error("Part must be gotten or created: "+t+NaN+e);return s}getPart(t,e,s){let i=this.parts.get(t);void 0===i&&this.parts.set(t,i=new Map);let r=i.get(e);return void 0===r?s?(r={entities:[],random:!0,px:t,py:e},i.set(e,r),[r,"new"]):null:[r,"existing"]}add(t,e){if(this.byId.has(e.id))throw new Error("Entity with the id already exists: "+e.id);this.byId.set(e.id,e),e.setGame(this.game),this.tree.insert(e.xy,e.linearSize(),e),t.entities.push(e),t.entities.sort(((t,e)=>t.layer>e.layer?1:t.layer==e.layer?0:-1))}}class N{baseUrl;version;constructor(t,e="v1"){this.baseUrl=t,this.version=e}put(t,e){return new Promise(((s,i)=>{var r=new XMLHttpRequest;r.open("PUT",`${this.baseUrl}/${this.version}${t}.json`),r.onreadystatechange=()=>{4===r.readyState&&(r.status.toString().startsWith("2")?s(JSON.parse(r.responseText)):i(r))},r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json"),r.send(e)}))}delete(t){return new Promise(((e,s)=>{var i=new XMLHttpRequest;i.open("DELETE",`${this.baseUrl}/${this.version}${t}.json`),i.onreadystatechange=()=>{4===i.readyState&&(i.status.toString().startsWith("2")?e(JSON.parse(i.responseText)):s(i))},i.setRequestHeader("Accept","application/json")}))}getString(t,e){return new Promise(((s,i)=>{var r=new XMLHttpRequest;r.open("GET",`${this.baseUrl}/${this.version}${t}.json`+(e?"?shallow=true":"")),r.onreadystatechange=()=>{4===r.readyState&&(r.status.toString().startsWith("2")?s(r.responseText):i(r))},r.setRequestHeader("Accept","application/json"),r.send()}))}get(t,e){return this.getString(t,e).then((t=>JSON.parse(t)))}load(t){return this.get(t,!1)}loadString(t){return this.getString(t,!1)}saveString(t,e){return this.put(t,e).then()}deleteString(t){return this.delete(t).then()}loadKeys(t){return this.get(t,!0).then((t=>null!=t?Object.keys(t):[]))}}class V{ctx;localMode;userId;masterGameNode=!1;frameCallback=null;gameOverCallback=null;newGameCallback=null;paused=!1;flies;fliesById;fliesToAddAfterTick;overlays;triggers;gameIsOver=!1;inbetween=!1;lastT;timeScale;boosterIsUsed;globalTime;rotationDirection;fakeTargetTimerId;outOfRange;fps;plane;level;gameMap;radarCtx=null;constructor(t,e=!0,s){this.ctx=t,this.localMode=e,this.userId=s,this.init()}startFromTheBeginning(){this.paused=!0,x.Z.clearAll(),this.flies=[],this.fliesById=new Map,this.fliesToAddAfterTick=[],this.overlays=[],this.triggers=[],this.gameIsOver=!1,this.inbetween=!1,this.lastT=null,this.timeScale=1,this.boosterIsUsed=!1,this.globalTime=0,this.rotationDirection=null,this.fakeTargetTimerId=null,this.outOfRange=!1,this.fps=0,this.plane=new b.JO(t.T.planeStartPos),this.plane.subscribe((t=>this.onPlaneEvent(t))),this.userId&&(this.plane.id=this.userId),this.level=new T,this.gameMap&&this.gameMap.deleteAllCustomContent(),this.gameMap=new U(this,200,1500,"first-game",new $(new O(new N("https://missiles-e8ad3.firebaseio.com")),new R)),this.addEntity(this.plane),this.level.init(this),v.Z.init(this),this.resume()}onPlaneEvent(e){e instanceof b.$7&&(e.amount>0&&this.achievement(t.t`${t.T.life} +${e.amount}`,t.T.lifeColor,2e3,e.target),null!==e.target&&e.target.lifes<=0&&this.explosionFor(e.target)),e instanceof b.gF&&e.amount>0&&e.target&&e.target.addInfo("fake targets",(()=>t.t`${t.T.fakeTarget} +${e.amount}`),3e3,t.T.fakeTargetColor),e instanceof b.qF&&e.amount>0&&e.target&&e.target.addInfo("booster",(()=>t.t`${t.T.booster} +${Math.round(e.amount/1e3)}`),3e3,t.T.boosterColor)}achievement(t,e,s,i){this.addEntity(new b.PE((i||this.plane).xy,t,e,s))}addInfo(t,e,s,i){this.plane.addInfo(t,e,s,i)}removeInfo(t){this.plane.removeInfo(t)}addEntity(t){if(t instanceof b.MB)throw new Error("Static entities can't be added here");t.setGame(this),this.inbetween?this.fliesToAddAfterTick.push(t):(this.flies.push(t),this.fliesById.set(t.id,t),this.sort())}teleportTo(t){this.plane.xy=t,this.gameMap.iAmHere(this.plane.xy).then((()=>console.log("teleported",t[0],t[1])))}addNewFlies(){this.fliesToAddAfterTick.length>0&&(this.fliesToAddAfterTick.forEach((t=>{this.flies.push(t),this.fliesById.set(t.id,t)})),this.sort(),this.fliesToAddAfterTick=[])}sort(){this.flies.sort(((t,e)=>t.layer>e.layer?1:t.layer==e.layer?0:-1))}addTrigger(t){this.triggers.push(t)}addOverlay(t){return this.overlays.push(t),()=>{const e=this.overlays.indexOf(t);e>=0&&this.overlays.splice(e,1)}}init(){var e,s;y(),g(),e=()=>this.pause(),s=()=>this.resume(),d("F1",[],t.t`Show this help message (F1 again to hide)`,(()=>{e&&e();const i=document.getElementById("help");let r;const a=()=>{m(r),i.style.display="none",s&&s()};if("block"==i.style.display)return void a();let o=u();r=p(),y(),d("Escape",[],t.t`Hide help message`,(()=>a())),d("F1",[],t.t`Hide help message`,(()=>a())),i.innerHTML="<h2>"+t.t`Keyboard`+"</h2>\n<pre>"+o.keys.join("\n</pre><pre>")+"</pre>",i.style.display="block"})),d("ArrowRight",[],t.t`Turn right`,(()=>{this.rotationDirection="right",this.plane.right()}),(()=>{"right"==this.rotationDirection&&this.plane.noRotate()})),d("ArrowLeft",[],t.t`Turn left`,(()=>{this.rotationDirection="left",this.plane.left()}),(()=>{"left"==this.rotationDirection&&this.plane.noRotate()})),d("KeyF",[],t.t`Fast/Unfast`,(()=>{this.timeScale<1?this.timeScale=1:this.timeScale=Math.max(this.timeScale/1.8,.01)})),d("KeyS",[],t.t`Slowmo/Unslowmo`,(()=>{this.timeScale>1?this.timeScale=1:this.timeScale=Math.min(2.5*this.timeScale,10)})),d("ArrowUp",[],t.t`Boost/Unboost`,(()=>{this.boosterIsUsed?(this.plane.maxVelocity=.1,this.plane.stopBoost()):(this.plane.maxVelocity=this.plane.booster>0?.15:.1,this.plane.startBoost()),this.boosterIsUsed=!this.boosterIsUsed})),d("ArrowDown",[],t.t`Unboost`,(()=>{this.boosterIsUsed&&(this.plane.maxVelocity=.1,this.plane.stopBoost(),this.boosterIsUsed=!1)})),d("Escape",[],t.t`Start from the beginning`,(()=>this.gameOver(0))),d("KeyP",[],t.t`Pause`,(()=>{this.gameIsOver||(this.pause(),_(t.t`Paused`,(()=>this.resume())))})),d("Space",[],t.t`Launch fake targets`,(()=>this.launchFakeTarget()))}frame(t){if(this.paused)return;if(this.gameMap.iAmHere(this.plane.xy),!this.gameMap.isPartAvailableForXy(this.plane.xy))return void requestAnimationFrame((t=>this.frame(t)));this.inbetween=!0,null===this.lastT&&(this.lastT=t);let e=t-this.lastT;x.Z.progress(e),this.fps=e>0?(100*this.fps+1e3/e)/101:0,e/=this.timeScale,this.lastT=t,this.globalTime+=e,this.level.progress(e),this.updateBooster(e),this.progress(e),this.detectCollision(),this.triggers.forEach((t=>t(e))),this.removeDead(),this.addNewFlies(),this.draw(),this.frameCallback&&this.frameCallback(),requestAnimationFrame((t=>this.frame(t))),this.inbetween=!1}updateBooster(t){this.boosterIsUsed&&(this.plane.booster-=t,this.plane.booster<=0&&(this.plane.booster=0,this.boosterIsUsed=!1,this.plane.maxVelocity=.1,this.plane.stopBoost()))}progress(t){const e=e=>e.progress(t);for(let t of this.flies)e(t);for(let t of this.gameMap.all())e(t)}detectCollision(){if(this.localMode||this.masterGameNode)for(let t=0;t<this.flies.length;t++){const e=this.flies[t];for(let s=t+1;s<this.flies.length;s++){const t=this.flies[s];this.tryCollide(e,t)}for(const t of this.gameMap.find(e.xy,e.linearSize()))this.tryCollide(e,t)}}tryCollide(t,e){if(t!==e&&!(t instanceof b.JA&&e instanceof b.JA)&&t.collideWith(e)){if(t instanceof b.JO&&e instanceof b.JO)return t.lifes=1,e.lifes=1,t.lifes-=1,void(e.lifes-=1);if(t instanceof b.JO||e instanceof b.JO){const s=t instanceof b.JO?e:t,i=t instanceof b.JO?t:e;if(s instanceof b.Hs)return void s.collected(i);s instanceof b.JA?i.lifes=1:this.explosionFor(s),i.lifes-=1}else t instanceof b.Cp&&this.level.onDeadMissile(t),e instanceof b.Cp&&this.level.onDeadMissile(e),t instanceof b.JA||this.explosionFor(t),e instanceof b.JA||this.explosionFor(e)}}removeDead(){const t=[];for(const e of this.gameMap.all())e.dead&&t.push(e);t.length>0&&t.forEach((t=>this.gameMap.removeEntity(t)));const e=this.flies.filter((t=>t.dead));if(e.length>0){let t=!1;e.forEach((e=>{e===this.plane&&(t=!0),this.flies.splice(this.flies.indexOf(e),1).forEach((t=>{t.setGame(null),this.fliesById.delete(t.id)}))})),t&&this.gameOver()}}gameOver(e){this.gameMap.saveChanged().then((()=>{this.gameIsOver=!0,null!==this.gameOverCallback&&this.gameOverCallback();const s=setTimeout((()=>{this.pause(),_(t.t`Game Over`,(()=>{clearTimeout(s),null!==this.newGameCallback?this.newGameCallback():this.startFromTheBeginning()}))}),void 0!==e?e:2e3)}))}explosionFor(t){t.dead=!0,this.addEntity(new b.OQ(t.xy,t instanceof b.JO?5:1))}draw(){this.ctx.fillStyle=this.outOfRange?t.T.skyOutOfRangeColor:t.T.skyColor,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.overlays.forEach((t=>{this.ctx.save(),t.drawPre(this.ctx),this.ctx.restore()})),this.ctx.save(),this.ctx.translate(-this.plane.xy[0]+this.ctx.canvas.width/2,-this.plane.xy[1]+this.ctx.canvas.height/2),this.flies.forEach((t=>{this.ctx.save(),t.draw(this.ctx),this.ctx.restore()}));for(const t of this.gameMap.all())this.ctx.save(),t.draw(this.ctx),this.ctx.restore();this.overlays.forEach((t=>{this.ctx.save(),t.drawOverMap(this.ctx),this.ctx.restore()})),this.ctx.restore(),this.ctx.save(),this.drawScore(this.ctx),this.ctx.restore(),this.ctx.save(),this.drawRadar(this.ctx),this.ctx.restore(),this.ctx.save(),this.overlays.forEach((t=>{this.ctx.save(),t.drawPost(this.ctx),this.ctx.restore()})),this.ctx.restore()}drawScore(e){const s=14*1.1;let i=s;e.font="14px serif",e.fillStyle="black",e.fillText("FPS: "+Math.round(this.fps),0,i),i+=s,e.fillStyle=t.T.timeColor,e.fillText(t.t`${t.T.time} ${Math.round(this.globalTime/1e3)}`,0,i),i+=s,e.fillStyle=t.T.scoreColor,e.fillText(t.t`${t.T.score} ${this.plane.score}`,0,i),i+=s,e.fillStyle=t.T.fakeTargetColor,e.fillText(t.t`${t.T.fakeTarget} ${this.plane.fakeTargets}`,0,i),i+=s,e.fillStyle=t.T.boosterColor,e.fillText(t.t`${t.T.booster} ${Math.round(this.plane.booster/1e3)}`,0,i),i+=s,e.fillStyle=t.T.lifeColor,e.fillText(t.t`${t.T.life} ${this.plane.lifes}`,0,i)}drawRadar(e){const s=t.T.radarSize,i=t.T.radarScale;if(null===this.radarCtx){const t=document.createElement("canvas");t.width=2*s+5,t.height=2*s+5,this.radarCtx=t.getContext("2d")}if(null===this.radarCtx)return;const r=this.radarCtx,a=r.canvas.width,o=r.canvas.height;r.save(),r.clearRect(0,0,a,o);const n=e.canvas.height/e.canvas.width;r.scale(1,n);const l=a/2,h=o/2;r.fillStyle=t.T.radarFillColor,r.strokeStyle=t.T.radarStrokeColor,r.beginPath(),r.arc(l,h,s,0,2*Math.PI),r.fill(),r.beginPath(),r.arc(l,h,s,0,2*Math.PI),r.stroke(),r.strokeStyle=t.T.radarSectorColor;for(let t=0;t<6;t++){r.beginPath(),r.moveTo(l,h);const e=2*Math.PI/6*t;r.lineTo(l+Math.cos(e)*s,h+Math.sin(e)*s),r.stroke()}r.beginPath(),r.arc(l,h,s,0,2*Math.PI),r.clip(),r.strokeStyle=t.T.radarVisibilityAreaColor,r.beginPath(),r.arc(l,h,e.canvas.height/2/i,0,2*Math.PI),r.stroke(),r.scale(1/i,1/i),r.translate(-this.plane.xy[0],-this.plane.xy[1]),r.translate(a/2*i,o/2*i),r.strokeStyle=t.T.radarPlaneColor,r.lineWidth=i,r.beginPath(),r.moveTo(this.plane.xy[0],this.plane.xy[1]-3*i/n),r.lineTo(this.plane.xy[0],this.plane.xy[1]+3*i/n),r.moveTo(this.plane.xy[0]-3*i,this.plane.xy[1]),r.lineTo(this.plane.xy[0]+3*i,this.plane.xy[1]),r.stroke();for(const t of this.gameMap.all())r.save(),r.globalAlpha=.4,t.draw(r),r.restore();for(let e of this.flies)r.save(),e!==this.plane&&e instanceof b.JO?(r.strokeStyle=t.T.radarEnemyColor,r.beginPath(),r.moveTo(e.xy[0]-3*i,e.xy[1]),r.lineTo(e.xy[0]+3*i,e.xy[1]),r.moveTo(e.xy[0],e.xy[1]-3*i/n),r.lineTo(e.xy[0],e.xy[1]+3*i/n),r.stroke()):(e instanceof b.Cp||e instanceof b.Hs)&&(r.fillStyle=e instanceof b.Cp?t.T.radarMissileColor:t.T.radarPerkColor,r.beginPath(),r.ellipse(e.xy[0],e.xy[1],2*i,2*i/n,0,0,2*Math.PI),r.fill()),r.restore();r.restore(),e.globalAlpha=t.T.radarAlpha,e.drawImage(r.canvas,e.canvas.width-2*s-10,10)}pause(){this.paused||(this.paused=!0,this.gameMap.saveChanged())}resume(){this.paused&&(this.lastT=null,this.paused=!1,requestAnimationFrame((t=>this.frame(t))))}launchFakeTarget(){if(this.plane.fakeTargets<=0)return;if(!this.fakeTargetTimerId)return this.fakeTargetTimerId=x.Z.set((()=>{this.plane.hideFakeTargetRadius(),this.fakeTargetTimerId=null}),2e3),void this.plane.showFakeTargetRadius(t.T.fakeTargetRadius);this.plane.fakeTargets-=1;const e=new b.jA(this.plane);this.addEntity(e)}}setTimeout((function(){const t=document.getElementById("canvas"),e=t.getContext("2d");f(t);const s=document.createElement("canvas");s.getContext("2d"),window.onresize=()=>{t.width=window.innerWidth,t.height=window.innerHeight,t.style.position="fixed",t.style.left="0",t.style.top="0",s.width=t.width,s.height=t.height},window.onresize(new UIEvent("")),new V(e).startFromTheBeginning()}),1)})(),(t=l(165)).T["Boost/Unboost"]="Ускорение/Отменить",t.T["Center/Uncenter"]="Отцентрировать/Отменить",t.T["Chase it to death!"]="Загоняй его до смерти!",t.T["Deadly chaser!"]="Ты смертильный загонщик!",t.T["Fast/Unfast"]="Время быстрее/нормальное",t.T["Game Over"]="Конец",t.T["Hide help message"]="Спрятать помощь",t.T["Hide the message"]="Спрятать это сообщение",t.T.Keyboard="Кнопки",t.T["Launch fake targets"]="Запустить ложную цель",t.T.Pause="Пауза",t.T.Paused="Пауза",t.T["Show this help message (F1 again to hide)"]="Показать помощь (F1 чтобы спрятать)",t.T["Slowmo/Unslowmo"]="Замедлить время/нормальное",t.T["Start from the beginning"]="Начать сначала",t.T["Turn left"]="Поворот влево",t.T["Turn right"]="Поворот вправо",t.T.Unboost="Отменить ускорение",t.T.Left="Левая",t.T.Middle="Средняя",t.T.Right="Правая",t.T.ArrowRight="→",t.T.ArrowLeft="←",t.T.ArrowUp="↑",t.T.ArrowDown="↓",t.T.Space="Пробел",t.T["Initializing..."]="Инициализация...",t.T["Connecting..."]="Подключение к серверу...",t.T.enemy="враг",e=l(381),s=l(925),i=l(349),r=l(464),a=l(165),e.Z.register("retarget-missiles",[],(t=>{s.Z.periodic((function(){let s=t.flies.filter((t=>t instanceof i.JO||t instanceof i.jA));s.length>1&&t.flies.filter((t=>t instanceof i.Cp)).forEach((t=>{let a=t.target?r.Z.dist(t.xy,t.target.xy):1/0,o=s.filter((e=>e!==t.target)).filter((e=>!(e instanceof i.JO)||r.Z.dotProduct(r.Z.subtract(e.xy,t.xy),t.v)>=0)).map((e=>(e.distToM=r.Z.dist(t.xy,e.xy),e)));o.length>0&&(o.sort(((t,e)=>t.distToM<e.distToM?-1:t.distToM>e.distToM?1:0)),o[0].distToM<e&&o[0].distToM<a&&t.retarget(o[0]))}))}),300);const e=a.T.fakeTargetRadius})),(()=>{var t=l(381),e=l(658),s=l(165);t.Z.register(e.N,[],(t=>{let i=s.T.telemetryWindowSeconds*s.T.telemetrySamplesPerSecond,r=new e.N(1e3/s.T.telemetrySamplesPerSecond,t,i);return t.addTrigger(r.toTrigger()),r}))})(),(()=>{var t=l(381),e=l(811),s=l(658);t.Z.register(e.g,[s.N],((t,s)=>{let i=new e.g(s.capacity);return t.addTrigger((t=>i.step(s))),i}))})(),(()=>{var t=l(381),e=l(811),s=l(607);class i{toState;condition;run;constructor(t,e,s){this.toState=t,this.condition=e,this.run=s}transit(t,e){return!this.condition||this.condition(t,e)?(this.run&&this.run(t,e),this.toState):null}}class r{name;transitions;constructor(t,e){this.name=t,this.transitions=e}}class a{startState;sampleFilter;debug=!1;constructor(t,e){this.startState=t,this.sampleFilter=e}process(t,e,i){i=i||0,e.stateReached=null;let r=new s.H(t,i);for(e._state=this.startState,this.debug&&console.groupCollapsed("FSA"),this.debug&&console.log("[start]",e._state.name);!r.atEnd();){let t=r.next();if(this.sampleFilter&&!this.sampleFilter(t,e)){this.debug&&console.log("[skip sample]",t);continue}this.debug&&console.log("[sample]",t);let s=null;for(let i of e._state.transitions)if(s=i.transit(t,e),null!==s){e.stateReached=s.name,this.debug&&console.log("[transition]",e._state.name," => ",s.name,"[context]",Object.assign({},e));break}if(null===s){this.debug&&console.log("[end]",e._state,"[context]",Object.assign({},e));break}e._state=s}return this.debug&&console.log("[buffer consumed]",r.atEnd()?"'till end":"'till "+r.idx),this.debug&&console.groupEnd(),r.atEnd()?-1:r.idx}step(t,e){if(void 0===e._state&&(e._state=this.startState),this.sampleFilter&&!this.sampleFilter(t,e))return this.debug&&console.log("[skip sample]",t),!0;this.debug&&console.log("[sample]",t);let s=null;for(let i of e._state.transitions)if(s=i.transit(t,e),null!==s)return e.stateReached=s.name,this.debug&&console.log("[transition]",e._state.name," => ",s.name,"[context]",Object.assign({},e)),e._state=s,!0;return this.debug&&console.log("[end]",e._state,"[context]",Object.assign({},e)),delete e._state,!1}}class o{name;builders;_sampleFilter;transitions=[];constructor(t="<ROOT>",e){this.name=t,this.builders=e?e.builders:new Map,this._sampleFilter=e?e._sampleFilter:null}sampleFilter(t){if(null!==this._sampleFilter)throw new Error("sampleFilter already set");return this._sampleFilter=t,this}transition(t,e,s){return this.state(t),this.transitions.push({toStateName:t,condition:e,run:s}),this}state(t){let e=this.builders.get(t);return void 0===e&&(e=new o(t,this),this.builders.set(t,e)),e}build(t){let e=new Map;for(let t of this.builders.values())e.has(t.name)||e.set(t.name,new r(t.name,[]));for(let t of this.builders.values()){let s=e.get(t.name);if(void 0===s)throw new Error("Can't find state: "+t.name);for(let r of t.transitions){let t=e.get(r.toStateName);if(void 0===t)throw new Error("Can't find state: "+r.toStateName);s.transitions.push(new i(t,r.condition,r.run))}}let s=e.get(t);if(void 0===s)throw new Error("Can't find state: "+t);return new a(s,this._sampleFilter)}}var n=l(658),h=l(165);t.Z.register("deadly-chasing",[e.g,n.N],((t,e)=>{const s=(t,e)=>t.sameDir&&t.dist<100&&t.behind,i=3*h.T.telemetrySamplesPerSecond;let r=(new o).sampleFilter(((t,e)=>t.t>e.lastFsaTriggerTime)).state("start").transition("start",((t,e)=>!s(t))).transition("chasing",s,((t,e)=>e.chasingCount=1)).state("chasing").transition("chasing",s,((t,e)=>e.chasingCount++)).transition("death",((t,e)=>t.missileIsDead),((t,e)=>e.deathTime=t.t)).transition("inbetween",((t,e)=>e.chasingCount>=i),((t,e)=>e.inbetweenCount=1)).state("inbetween").transition("death",((t,e)=>e.inbetweenCount<=.5*e.chasingCount&&t.missileIsDead),((t,e)=>e.deathTime=t.t)).transition("inbetween",((t,e)=>e.inbetweenCount<=.5*e.chasingCount&&!t.missileIsDead),((t,e)=>e.inbetweenCount++)).transition("failed").build("start"),a=new class{lastFsaTriggerTime;stateReached;chasingCount;deathTime;inbetweenCount;constructor(){this.reset(),this.lastFsaTriggerTime=0}reset(){this.stateReached=null,this.chasingCount=0,this.deathTime=void 0}};e.addStep((e=>{r.step(e,a)?("failed"==a.stateReached&&a.reset(),a.chasingCount>i?t.addInfo("chasingCount",(()=>h.t`Chase it to death!`),500):t.removeInfo("chasingCount"),void 0!==a.deathTime&&(t.addInfo("deadly chaser",h.t`Deadly chaser!`,3e3),t.plane.score+=10,a.lastFsaTriggerTime=a.deathTime,a.reset())):a.reset()}))}))})()})();